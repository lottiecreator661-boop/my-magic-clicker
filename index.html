<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TON Empire Hardcore</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --accent: #0098EA; --glass: rgba(255, 255, 255, 0.1); --bg: #0f172a; }
        body {
            background: radial-gradient(circle at top, #1e1b4b, var(--bg));
            color: #fff; text-align: center; font-family: 'Segoe UI', sans-serif;
            margin: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh;
        }

        .top-bar { background: rgba(0,0,0,0.3); backdrop-filter: blur(15px); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--glass); }
        .balance-val { font-size: 22px; font-weight: bold; color: var(--accent); }

        .tab-content { flex-grow: 1; display: none; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; width: 100%; box-sizing: border-box; }
        .active-tab { display: flex; }

        /* –ö–õ–ò–ö–ï–† */
        #coin { width: 180px; height: 180px; background: radial-gradient(circle, #38bdf8, #0098EA); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 40px rgba(0,152,234,0.4); transition: 0.1s; margin: 20px 0; border: 4px solid rgba(255,255,255,0.2); font-size: 50px; cursor: pointer; }
        #coin:active { transform: scale(0.95); }

        /* –ì–ï–ô–ú–ü–õ–ï–ô –≠–õ–ï–ú–ï–ù–¢–´ */
        .input-group { background: var(--glass); padding: 15px; border-radius: 20px; width: 90%; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05); }
        .input-field { background: #0f172a; border: 1px solid #334155; color: #fff; padding: 10px; border-radius: 10px; width: 80%; text-align: center; margin: 5px 0; font-weight: bold; }
        
        /* –ú–ò–ù–´ */
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin: 15px 0; }
        .m-cell { width: 55px; height: 55px; background: #334155; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; transition: 0.2s; }
        .m-cell.gem { background: #10b981; box-shadow: 0 0 15px #10b981; }
        .m-cell.bomb { background: #ef4444; box-shadow: 0 0 15px #ef4444; }

        /* –õ–ï–°–ï–ù–ö–ê */
        .ladder-grid { display: flex; flex-direction: column-reverse; gap: 8px; width: 260px; }
        .ladder-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; transition: 0.3s; }
        .ladder-row.locked { opacity: 0.2; pointer-events: none; transform: scale(0.95); }
        .l-cell { background: #334155; padding: 15px; border-radius: 12px; font-weight: bold; border: 2px solid rgba(255,255,255,0.1); }
        .l-cell.win { background: #10b981; border-color: #fff; }

        /* –ö–ù–û–ü–ö–ò */
        .btn { border: none; padding: 14px; border-radius: 12px; font-weight: bold; color: #fff; width: 100%; cursor: pointer; transition: 0.2s; }
        .btn-blue { background: var(--accent); }
        .btn-orange { background: #f59e0b; margin-top: 10px; }
        .btn-red { background: #ef4444; margin-top: 10px; }
        .btn:active { transform: scale(0.98); }

        /* NAV */
        .bottom-nav { background: #0f172a; border-top: 1px solid var(--glass); display: flex; justify-content: space-around; padding: 10px 0 25px 0; }
        .nav-item { color: #94a3b8; font-size: 12px; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--accent); }
    </style>
</head>
<body>

    <div class="top-bar">
        <div><div style="font-size: 10px; color: #94a3b8;">–ë–ê–õ–ê–ù–°</div><div class="balance-val">üíé <span id="balance">0</span></div></div>
        <button class="btn btn-blue" style="width: auto; padding: 6px 15px;" onclick="tg.openTelegramLink('https://t.me/fresei')">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
    </div>

    <div id="tab-farm" class="tab-content active-tab">
        <div id="coin">üíé</div>
        <div style="font-size: 24px; font-weight: bold; color: #34d399;">‚ö° <span id="energy">250</span></div>
    </div>

    <div id="tab-games" class="tab-content">
        <div id="games-list" style="width: 100%;">
            <div style="background: var(--glass); padding: 15px; border-radius: 15px; margin-bottom: 10px;" onclick="openGame('mines')">üí£ –ú–ò–ù–´ (–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤)</div>
            <div style="background: var(--glass); padding: 15px; border-radius: 15px; margin-bottom: 10px;" onclick="openGame('ladder')">ü™ú –õ–ï–°–ï–ù–ö–ê (–ü–æ —à–∞–≥–∞–º)</div>
        </div>

        <div id="game-ui" style="display:none; width: 100%;">
            <h2 id="game-title">–ò–≥—Ä–∞</h2>
            <div id="game-container"></div>
            <div id="game-stats" style="margin: 15px 0; color: #f59e0b; font-size: 18px; min-height: 24px;"></div>
            <button id="cashout-btn" class="btn btn-orange" style="display:none" onclick="processCashout()">–ó–ê–ë–†–ê–¢–¨</button>
            <button class="btn btn-red" onclick="exitGame()">–í–´–ô–¢–ò</button>
        </div>
    </div>

    <div id="tab-admin" class="tab-content">
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (ID –∏–ª–∏ Username)</h3>
        <input type="text" id="adm-target" class="input-field" placeholder="ID –∏–ª–∏ @username">
        <input type="number" id="adm-val" class="input-field" placeholder="–°—É–º–º–∞ TON">
        <button class="btn btn-blue" onclick="adminMod('money')">–í—ã–¥–∞—Ç—å TON</button>
        <button class="btn btn-orange" onclick="adminMod('vip')">–í—ã–¥–∞—Ç—å VIP (+–õ–∏–º–∏—Ç)</button>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('farm', this)"><b>üíé</b><br>–§–∞—Ä–º</div>
        <div class="nav-item" onclick="switchTab('games', this)"><b>üé≤</b><br>–ò–≥—Ä—ã</div>
        <div id="admin-btn" class="nav-item" style="display:none" onclick="switchTab('admin', this)"><b>‚öôÔ∏è</b><br>–ê–¥–º–∏–Ω</div>
    </div>

    <script>
        const ADMINS = [7177436669, 8388334620];
        let tg = window.Telegram.WebApp;
        let userId = tg.initDataUnsafe?.user?.id || 0;
        let db = JSON.parse(localStorage.getItem('ton_empire_v5')) || { bal: 50, clk: 0, nrg: 250, last: Date.now(), vip: false };

        let activeGame = { status: false, bet: 0, mult: 1, type: '', data: null, step: 0 };

        function save() { localStorage.setItem('ton_empire_v5', JSON.stringify(db)); }

        function updateUI() {
            document.getElementById('balance').innerText = db.bal.toFixed(2);
            document.getElementById('energy').innerText = Math.floor(db.nrg);
            if(ADMINS.includes(userId)) document.getElementById('admin-btn').style.display = 'block';
            save();
        }

        function switchTab(id, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('tab-' + id).classList.add('active-tab');
            el.classList.add('active');
            exitGame();
        }

        // --- –ú–ò–ù–´ ---
        function openGame(type) {
            document.getElementById('games-list').style.display = 'none';
            document.getElementById('game-ui').style.display = 'block';
            activeGame.type = type;
            let container = document.getElementById('game-container');
            
            if(type === 'mines') {
                document.getElementById('game-title').innerText = "–ú–ò–ù–´";
                container.innerHTML = `
                    <div class="input-group">
                        <input type="number" id="m-bet" class="input-field" placeholder="–°—Ç–∞–≤–∫–∞ TON">
                        <input type="number" id="m-count" class="input-field" placeholder="–ö–æ–ª-–≤–æ –º–∏–Ω (1-24)" value="3">
                        <button class="btn btn-blue" onclick="startMines()">–ü–û–ì–ù–ê–õ–ò</button>
                    </div>
                    <div id="m-grid" class="mines-grid"></div>
                `;
            } else if(type === 'ladder') {
                document.getElementById('game-title').innerText = "–õ–ï–°–ï–ù–ö–ê";
                container.innerHTML = `
                    <div class="input-group">
                        <input type="number" id="l-bet" class="input-field" placeholder="–°—Ç–∞–≤–∫–∞ TON">
                        <button class="btn btn-blue" onclick="startLadder()">–ù–ê–ß–ê–¢–¨</button>
                    </div>
                    <div id="l-grid" class="ladder-grid"></div>
                `;
            }
        }

        function startMines() {
            let bet = parseFloat(document.getElementById('m-bet').value);
            let count = parseInt(document.getElementById('m-count').value);
            if(bet > db.bal || bet <= 0 || count < 1 || count > 24) return alert("–û—à–∏–±–∫–∞ –≤ —Å—Ç–∞–≤–∫–µ –∏–ª–∏ –º–∏–Ω–∞—Ö!");

            db.bal -= bet; updateUI();
            activeGame = { status: true, bet: bet, mult: 1, type: 'mines', data: Array(25).fill(false), stepCount: count };
            
            let p = 0; while(p < count) { let r = Math.floor(Math.random()*25); if(!activeGame.data[r]){activeGame.data[r]=true; p++;} }

            let grid = document.getElementById('m-grid'); grid.innerHTML = '';
            for(let i=0; i<25; i++) {
                let c = document.createElement('div'); c.className = 'm-cell'; c.innerText = '?';
                c.onclick = () => {
                    if(!activeGame.status || c.classList.contains('open')) return;
                    c.classList.add('open');
                    if(activeGame.data[i]) {
                        c.className = 'm-cell bomb'; c.innerText = 'üí£';
                        gameOver(false);
                    } else {
                        c.className = 'm-cell gem'; c.innerText = 'üíé';
                        let step = (count / 4) + 0.2;
                        activeGame.mult += step;
                        document.getElementById('game-stats').innerText = `–ó–∞–±–µ—Ä–µ—à—å: ${(activeGame.bet * activeGame.mult).toFixed(2)} | –°–ª–µ–¥: x${(activeGame.mult + step).toFixed(2)}`;
                        document.getElementById('cashout-btn').style.display = 'block';
                    }
                };
                grid.appendChild(c);
            }
        }

        // --- –õ–ï–°–ï–ù–ö–ê (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø) ---
        function startLadder() {
            let bet = parseFloat(document.getElementById('l-bet').value);
            if(bet > db.bal || bet <= 0) return alert("–ú–∞–ª–æ TON!");
            db.bal -= bet; updateUI();
            
            activeGame = { status: true, bet: bet, mult: 1, type: 'ladder', step: 0 };
            let grid = document.getElementById('l-grid'); grid.innerHTML = '';
            for(let i=0; i<7; i++) {
                let row = document.createElement('div');
                row.className = 'ladder-row' + (i > 0 ? ' locked' : '');
                let trap = Math.floor(Math.random()*2);
                row.innerHTML = `<div class="l-cell" onclick="clickL(0, ${trap}, ${i}, this)">?</div>
                                 <div class="l-cell" onclick="clickL(1, ${trap}, ${i}, this)">?</div>`;
                grid.appendChild(row);
            }
            document.getElementById('game-stats').innerText = "–®–∞–≥–∞–π –ø–æ –ø–µ—Ä–≤–æ–π —Å—Ç—É–ø–µ–Ω—å–∫–µ!";
        }

        function clickL(choice, trap, idx, el) {
            if(!activeGame.status || idx !== activeGame.step) return;
            if(choice === trap) {
                el.style.background = '#ef4444'; el.innerText = 'üí•';
                gameOver(false);
            } else {
                el.className = 'l-cell win'; el.innerText = 'üíé';
                activeGame.mult *= 2;
                activeGame.step++;
                document.getElementById('game-stats').innerText = `–í—ã–∏–≥—Ä—ã—à: ${(activeGame.bet * activeGame.mult).toFixed(2)} TON`;
                document.getElementById('cashout-btn').style.display = 'block';
                
                let rows = document.querySelectorAll('.ladder-row');
                if(activeGame.step < 7) rows[activeGame.step].classList.remove('locked');
                else gameOver(true); // –ü—Ä–æ—à–µ–ª –≤—Å—é –ª–µ—Å—Ç–Ω–∏—Ü—É
            }
        }

        function processCashout() {
            if(!activeGame.status) return;
            let win = activeGame.bet * activeGame.mult;
            db.bal += win;
            alert(`–£—Å–ø–µ—à–Ω–æ! +${win.toFixed(2)} TON`);
            exitGame();
            updateUI();
        }

        function gameOver(win) {
            activeGame.status = false;
            document.getElementById('cashout-btn').style.display = 'none';
            if(!win) {
                document.getElementById('game-stats').innerText = "–ü–†–û–ò–ì–†–´–®! –°—Ç–∞–≤–∫–∞ —Å–≥–æ—Ä–µ–ª–∞.";
                setTimeout(exitGame, 2000);
            }
            updateUI();
        }

        function exitGame() {
            document.getElementById('games-list').style.display = 'block';
            document.getElementById('game-ui').style.display = 'none';
            document.getElementById('cashout-btn').style.display = 'none';
            document.getElementById('game-stats').innerText = '';
            activeGame.status = false;
        }

        function adminMod(type) {
            let user = document.getElementById('adm-target').value;
            let val = parseFloat(document.getElementById('adm-val').value);
            if(user == userId || user == "@me") {
                if(type === 'money') db.bal += val;
                if(type === 'vip') db.vip = true;
                updateUI(); alert("–°–¥–µ–ª–∞–ª!");
            } else {
                alert("–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ (–Ω—É–∂–µ–Ω Firebase –¥–ª—è –ø–æ–∏—Å–∫–∞)");
            }
        }

        // –ö–ª–∏–∫–µ—Ä
        document.getElementById('coin').onclick = () => {
            if(db.nrg >= 1) { db.nrg--; db.bal += db.vip?1.5:0.5; updateUI(); }
        };

        setInterval(() => { db.nrg = Math.min(db.vip?10250:250, db.nrg + (db.vip?0.8:0.1)); updateUI(); }, 1000);
        updateUI();
    </script>
</body>
</html>
