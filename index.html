<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TON Empire</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò –ò –ö–†–ê–°–ò–í–´–ô –§–û–ù */
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            color: #ffffff; text-align: center; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0; overflow: hidden; display: flex; flex-direction: column;
            height: 100vh; position: relative; user-select: none;
        }

        /* –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ –ë–ê–õ–ê–ù–°–ê */
        .top-bar {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px);
            padding: 15px 20px; display: flex; justify-content: space-between;
            align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1);
            z-index: 10;
        }
        .balance-box { display: flex; flex-direction: column; align-items: flex-start; }
        .balance-title { font-size: 12px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; }
        .balance-amount { font-size: 24px; font-weight: bold; color: #0098EA; display: flex; align-items: center; gap: 5px; }
        
        .topup-btn {
            background: #0098EA; color: white; border: none; padding: 8px 15px;
            border-radius: 12px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(0, 152, 234, 0.4);
        }
        .topup-btn:active { transform: scale(0.95); }

        /* –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –í–ö–õ–ê–î–û–ö */
        .tab-content { flex-grow: 1; display: none; flex-direction: column; align-items: center; justify-content: center; position: relative; width: 100%; }
        .active-tab { display: flex; }

        /* –ö–õ–ò–ö–ï–† */
        .level-info { font-size: 16px; color: #a78bfa; margin-bottom: 30px; background: rgba(167, 139, 250, 0.1); padding: 5px 15px; border-radius: 20px; }
        
        /* –ö–†–ê–°–ò–í–ê–Ø –ö–ù–û–ü–ö–ê TON */
        #coin {
            width: 220px; height: 220px; background: radial-gradient(circle at 30% 30%, #38bdf8, #0098EA, #0284c7);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: 0 0 50px rgba(0, 152, 234, 0.5), inset 0 0 20px rgba(255,255,255,0.3);
            transition: transform 0.05s; border: 4px solid rgba(255,255,255,0.1); margin-bottom: 40px;
        }
        #coin:active { transform: scale(0.92); box-shadow: 0 0 30px rgba(0, 152, 234, 0.8); }
        .ton-logo { width: 100px; height: 100px; fill: white; }

        .energy-box { margin-top: 20px; font-size: 18px; color: #34d399; font-weight: bold; display: flex; align-items: center; gap: 8px; }

        /* –ú–ï–ù–Æ –ò–ì–† */
        .games-list { width: 90%; max-height: 70vh; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; padding-bottom: 20px; }
        .game-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .game-info { text-align: left; }
        .game-name { font-size: 18px; font-weight: bold; color: #fff; margin-bottom: 5px; }
        .game-desc { font-size: 12px; color: #94a3b8; }
        .play-btn { background: #8b5cf6; color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; cursor: pointer; }

        /* –ú–ê–ì–ê–ó–ò–ù –≠–ù–ï–†–ì–ò–ò */
        .shop-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 15px; width: 90%; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        
        /* –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ */
        .bottom-nav { background: rgba(15, 23, 42, 0.95); border-top: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-around; padding: 15px 0; z-index: 10; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #94a3b8; font-size: 12px; cursor: pointer; gap: 5px; transition: 0.2s; width: 33%; }
        .nav-item.active { color: #0098EA; }
        .nav-icon { font-size: 24px; }

        /* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê */
        .modal-overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 100; justify-content: center; align-items: center; }
        .modal-box { background: #1e293b; border: 1px solid #334155; padding: 25px; border-radius: 20px; width: 80%; text-align: center; }
        .modal-title { font-size: 22px; color: white; margin-bottom: 15px; font-weight: bold; }
        .modal-input { width: 90%; padding: 12px; margin-bottom: 15px; border-radius: 10px; border: 1px solid #475569; background: #0f172a; color: white; font-size: 18px; text-align: center; }
        .modal-btn { background: #10b981; color: white; border: none; padding: 12px 0; width: 100%; border-radius: 10px; font-size: 18px; font-weight: bold; margin-bottom: 10px; cursor: pointer; }
        .modal-close { background: #ef4444; }
        .modal-msg { margin-top: 15px; font-size: 16px; font-weight: bold; min-height: 24px; }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="balance-box">
            <span class="balance-title">–¢–≤–æ–π –ë–∞–ª–∞–Ω—Å</span>
            <span class="balance-amount">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#0098EA" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8l4 4-4 4-4-4 4-4z"/></svg>
                <span id="balance">0</span> TON
            </span>
        </div>
        <button class="topup-btn" onclick="openContactModal('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ')">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
    </div>

    <div id="tab-clicker" class="tab-content active-tab">
        <div class="level-info" id="level-text">üèÜ –£—Ä–æ–≤–µ–Ω—å: 1 (0 / 15000)</div>
        
        <div id="coin">
            <svg class="ton-logo" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L2 12l10 10 10-10L12 2zm0 4.5l5.5 5.5-5.5 5.5-5.5-5.5L12 6.5z"/>
            </svg>
        </div>
        
        <div class="energy-box">‚ö° –≠–Ω–µ—Ä–≥–∏—è: <span id="energy-text">1000/1000</span></div>
    </div>

    <div id="tab-games" class="tab-content">
        <h2 style="color: white; margin-bottom: 20px;">–ö–∞–∑–∏–Ω–æ Empire</h2>
        <div class="games-list">
            <div class="game-card">
                <div class="game-info">
                    <div class="game-name">üí£ –ú–∏–Ω—ã</div>
                    <div class="game-desc">–®–∞–Ω—Å: 70% | –ö—É—à: x1.5</div>
                </div>
                <button class="play-btn" onclick="openGameModal('–ú–∏–Ω—ã', 1.5, 0.7)">–ò–≥—Ä–∞—Ç—å</button>
            </div>
            <div class="game-card">
                <div class="game-info">
                    <div class="game-name">üìà –õ–µ—Å–µ–Ω–∫–∞</div>
                    <div class="game-desc">–®–∞–Ω—Å: 50% | –ö—É—à: x2.0</div>
                </div>
                <button class="play-btn" onclick="openGameModal('–õ–µ—Å–µ–Ω–∫–∞', 2.0, 0.5)">–ò–≥—Ä–∞—Ç—å</button>
            </div>
            <div class="game-card">
                <div class="game-info">
                    <div class="game-name">üÉè –ë–ª—ç–∫–¥–∂–µ–∫</div>
                    <div class="game-desc">–®–∞–Ω—Å: 30% | –ö—É—à: x3.0</div>
                </div>
                <button class="play-btn" onclick="openGameModal('–ë–ª—ç–∫–¥–∂–µ–∫', 3.0, 0.3)">–ò–≥—Ä–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="tab-shop" class="tab-content">
        <h2 style="color: white; margin-bottom: 20px;">–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∏</h2>
        <div class="games-list">
            <div class="shop-card">
                <div class="game-info">
                    <div class="game-name">üîã –ú–∞–ª–∞—è –∫–æ–ª–±–∞</div>
                    <div class="game-desc">+1 000 –≠–Ω–µ—Ä–≥–∏–∏</div>
                </div>
                <button class="topup-btn" onclick="openContactModal('–≠–Ω–µ—Ä–≥–∏—è')">–ö—É–ø–∏—Ç—å</button>
            </div>
            <div class="shop-card">
                <div class="game-info">
                    <div class="game-name">‚ö° –°—Ä–µ–¥–Ω—è—è –∫–æ–ª–±–∞</div>
                    <div class="game-desc">+10 000 –≠–Ω–µ—Ä–≥–∏–∏</div>
                </div>
                <button class="topup-btn" onclick="openContactModal('–≠–Ω–µ—Ä–≥–∏—è')">–ö—É–ø–∏—Ç—å</button>
            </div>
            <div class="shop-card">
                <div class="game-info">
                    <div class="game-name">‚ò¢Ô∏è –†–µ–∞–∫—Ç–æ—Ä</div>
                    <div class="game-desc">+100 000 –≠–Ω–µ—Ä–≥–∏–∏</div>
                </div>
                <button class="topup-btn" onclick="openContactModal('–≠–Ω–µ—Ä–≥–∏—è')">–ö—É–ø–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('clicker', this)">
            <div class="nav-icon">üíé</div>
            <div>–§–∞—Ä–º</div>
        </div>
        <div class="nav-item" onclick="switchTab('games', this)">
            <div class="nav-icon">üé≤</div>
            <div>–ò–≥—Ä—ã</div>
        </div>
        <div class="nav-item" onclick="switchTab('shop', this)">
            <div class="nav-icon">üõí</div>
            <div>–ú–∞–≥–∞–∑–∏–Ω</div>
        </div>
    </div>

    <div id="contact-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title" id="contact-title">–ü–æ–∫—É–ø–∫–∞</div>
            <div style="color: #cbd5e1; margin-bottom: 20px;">–î–ª—è –ø–æ–∫—É–ø–∫–∏ –∏–ª–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞–ø–∏—à–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É:</div>
            <div style="font-size: 24px; font-weight: bold; color: #0098EA; margin-bottom: 25px;">@fresei</div>
            <button class="modal-btn modal-close" onclick="closeModals()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div id="game-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title" id="game-title">–ò–≥—Ä–∞</div>
            <input type="number" id="bet-amount" class="modal-input" placeholder="–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏ (TON)">
            <button class="modal-btn" onclick="playCurrentGame()">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
            <button class="modal-btn modal-close" onclick="closeModals()">–í—ã–π—Ç–∏</button>
            <div id="game-result" class="modal-msg"></div>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand(); 

        // –ë–ê–ó–ê –î–ê–ù–ù–´–•
        let balance = 0;
        let clicksTotal = 0;
        let currentEnergy = 1000;
        let lastSaveTime = Date.now();

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const balanceEl = document.getElementById('balance');
        const levelEl = document.getElementById('level-text');
        const energyEl = document.getElementById('energy-text');
        const coin = document.getElementById('coin');

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∏–≥—Ä
        let currentGameName = '';
        let currentGameMult = 1;
        let currentGameChance = 0;

        // –ó–∞–≥—Ä—É–∑–∫–∞
        function loadData() {
            let saved = localStorage.getItem('ton_empire_db');
            if (saved) {
                let data = JSON.parse(saved);
                balance = data.balance || 0;
                clicksTotal = data.clicksTotal || 0;
                currentEnergy = data.energy !== undefined ? data.energy : 1000;
                lastSaveTime = data.lastSaveTime || Date.now();
            }
        }

        // –õ–æ–≥–∏–∫–∞ —É—Ä–æ–≤–Ω–µ–π
        function getLevel() {
            let lvl = Math.floor(clicksTotal / 15000) + 1;
            return lvl > 100 ? 100 : lvl;
        }

        function getMaxEnergy(lvl) {
            if (lvl < 10) return 1000;
            return Math.floor(lvl / 10) * 10000;
        }

        function regenOfflineEnergy() {
            let now = Date.now();
            let hoursPassed = (now - lastSaveTime) / (1000 * 60 * 60);
            currentEnergy += hoursPassed * 1000;
            let maxE = getMaxEnergy(getLevel());
            if (currentEnergy > maxE) currentEnergy = maxE;
            lastSaveTime = now;
        }

        function saveData() {
            localStorage.setItem('ton_empire_db', JSON.stringify({
                balance: balance, clicksTotal: clicksTotal, energy: currentEnergy, lastSaveTime: Date.now()
            }));
        }

        function updateUI() {
            balanceEl.innerText = Math.floor(balance).toLocaleString();
            let lvl = getLevel();
            let maxE = getMaxEnergy(lvl);
            if (lvl === 100) {
                levelEl.innerText = `üèÜ –£—Ä–æ–≤–µ–Ω—å: 100 (–ú–ê–ö–°–ò–ú–£–ú)`;
                levelEl.style.color = '#ef4444';
            } else {
                levelEl.innerText = `üèÜ –£—Ä–æ–≤–µ–Ω—å: ${lvl} (${clicksTotal}/${lvl * 15000})`;
            }
            energyEl.innerText = `${Math.floor(currentEnergy)}/${maxE}`;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        loadData(); regenOfflineEnergy(); updateUI();

        // –ö–õ–ò–ö–ï–†
        coin.addEventListener('click', () => {
            if (currentEnergy >= 1) {
                currentEnergy -= 1;
                clicksTotal += 1;
                balance += (getLevel() >= 100) ? 1000000 : 1;
                
                if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
                updateUI();
            } else {
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
                energyEl.style.color = '#ef4444'; 
                setTimeout(() => energyEl.style.color = '#34d399', 300);
            }
        });

        // –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–Ω–ª–∞–π–Ω
        setInterval(() => {
            let maxE = getMaxEnergy(getLevel());
            if (currentEnergy < maxE) {
                currentEnergy += (1000 / 3600);
                if (currentEnergy > maxE) currentEnergy = maxE;
                updateUI();
            }
        }, 1000);
        setInterval(saveData, 3000);

        // –ù–ê–í–ò–ì–ê–¶–ò–Ø (–í–ö–õ–ê–î–ö–ò)
        function switchTab(tabId, element) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active-tab'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active-tab');
            element.classList.add('active');
            if (tg.HapticFeedback) tg.HapticFeedback.selectionChanged();
        }

        // –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê
        function closeModals() {
            document.getElementById('contact-modal').style.display = 'none';
            document.getElementById('game-modal').style.display = 'none';
        }

        function openContactModal(title) {
            document.getElementById('contact-title').innerText = title;
            document.getElementById('contact-modal').style.display = 'flex';
        }

        function openGameModal(name, mult, chance) {
            currentGameName = name; currentGameMult = mult; currentGameChance = chance;
            document.getElementById('game-title').innerText = name;
            document.getElementById('bet-amount').value = '';
            document.getElementById('game-result').innerText = '';
            document.getElementById('game-result').style.color = 'white';
            document.getElementById('game-modal').style.display = 'flex';
        }

        // –õ–û–ì–ò–ö–ê –ò–ì–†–´ (–ö–ê–ó–ò–ù–û)
        function playCurrentGame() {
            let input = document.getElementById('bet-amount').value;
            let bet = parseInt(input);
            let resBox = document.getElementById('game-result');

            if (isNaN(bet) || bet <= 0) {
                resBox.innerText = "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç–∞–≤–∫—É!"; resBox.style.color = '#ef4444'; return;
            }
            if (bet > balance) {
                resBox.innerText = "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON!"; resBox.style.color = '#ef4444'; return;
            }

            // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
            balance -= bet;
            
            // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–±–µ–¥—É
            let isWin = Math.random() < currentGameChance;
            
            if (isWin) {
                let winAmount = bet * currentGameMult;
                balance += winAmount;
                resBox.innerText = `üéâ –ü–æ–±–µ–¥–∞! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winAmount} TON!`;
                resBox.style.color = '#10b981';
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            } else {
                resBox.innerText = `üí• –ü—Ä–æ–∏–≥—Ä—ã—à. –í—ã –ø–æ—Ç–µ—Ä—è–ª–∏ ${bet} TON.`;
                resBox.style.color = '#ef4444';
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
            }
            updateUI();
            saveData();
        }
    </script>
</body>
</html>
