<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üíé TON EMPIRE: ELITE</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --bg: #0a0c14;
            --surface: rgba(18, 24, 38, 0.8);
            --accent: #00e5ff;
            --accent-glow: 0 0 20px #00e5ff;
            --success: #00b894;
            --warning: #fdcb6e;
            --error: #d63031;
            --text: #ffffff;
            --text-secondary: #b2bec3;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(0, 229, 255, 0.2);
        }
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            position: relative;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle at 20% 30%, rgba(0,229,255,0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* –¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ */
        h1, h2, h3 { font-weight: 700; letter-spacing: -0.02em; }
        .glow { text-shadow: 0 0 10px var(--accent); }

        /* –®–∞–ø–∫–∞ */
        .top-bar {
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--surface);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .balance-block {
            display: flex;
            flex-direction: column;
        }
        .balance-label {
            font-size: 12px;
            color: var(--text-secondary);
        }
        .balance-value {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #fff, var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
        }
        .stats {
            display: flex;
            gap: 16px;
        }
        .stat-item {
            text-align: right;
        }
        .stat-value {
            font-weight: 700;
            font-size: 16px;
        }
        .stat-label {
            font-size: 10px;
            color: var(--text-secondary);
        }

        /* –£—Ä–æ–≤–Ω–∏ */
        .lvl-container {
            padding: 10px 20px;
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(5px);
            border-bottom: 1px solid var(--border);
        }
        .lvl-header {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 6px;
        }
        .lvl-bar-bg {
            height: 6px;
            background: #1e272e;
            border-radius: 3px;
            overflow: hidden;
        }
        #lvl-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #74b9ff);
            width: 0%;
            transition: 0.3s;
            box-shadow: var(--accent-glow);
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-bar {
            background: var(--surface);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 10px 0 20px 0;
            position: fixed;
            bottom: 0;
            width: 100%;
            border-top: 1px solid var(--border);
            z-index: 10;
        }
        .nav-item {
            color: var(--text-secondary);
            text-align: center;
            font-size: 12px;
            padding: 8px 12px;
            border-radius: 30px;
            transition: 0.2s;
            cursor: pointer;
        }
        .nav-item.active {
            background: rgba(0,229,255,0.15);
            color: var(--accent);
        }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–∞–±–æ–≤ */
        .tab-content {
            display: none;
            flex: 1;
            padding: 20px 20px 100px 20px;
            flex-direction: column;
            gap: 16px;
        }
        .active-tab { display: flex; animation: fade 0.2s; }
        @keyframes fade { from { opacity: 0; } to { opacity: 1; } }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .glass-card {
            background: var(--surface);
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 18px;
            width: 100%;
            transition: 0.2s;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }
        .glass-card-title {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            border: none;
            padding: 14px 24px;
            border-radius: 40px;
            font-weight: 700;
            font-size: 16px;
            background: rgba(255,255,255,0.1);
            color: white;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            transition: 0.2s;
            cursor: pointer;
            width: 100%;
            margin: 6px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--accent), #0984e3);
            border: none;
            box-shadow: 0 4px 20px rgba(0,229,255,0.4);
        }
        .btn-success {
            background: linear-gradient(135deg, var(--success), #00cec9);
        }
        .btn:active { transform: scale(0.97); }

        /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
        .input-dark {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            color: white;
            padding: 14px 18px;
            border-radius: 40px;
            width: 100%;
            font-size: 16px;
            outline: none;
            transition: 0.2s;
        }
        .input-dark:focus { border-color: var(--accent); box-shadow: 0 0 15px var(--accent); }

        /* –ò–≥—Ä–æ–≤—ã–µ —Å–µ—Ç–∫–∏ */
        .mines-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin: 15px 0;
        }
        .m-cell {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.1);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border: 1px solid var(--border);
            transition: 0.2s;
            cursor: pointer;
        }
        .m-cell.open-gem {
            background: linear-gradient(135deg, var(--accent), #0984e3);
            box-shadow: 0 0 20px var(--accent);
        }
        .m-cell.open-bomb {
            background: var(--error);
            box-shadow: 0 0 20px var(--error);
        }

        /* –õ–µ—Å–µ–Ω–∫–∞ */
        .ladder-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 8px 0;
        }
        .ladder-row.locked { opacity: 0.5; pointer-events: none; }
        .l-cell {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 30px;
            padding: 16px;
            text-align: center;
            font-size: 20px;
            cursor: pointer;
            transition: 0.2s;
        }

        /* –ë–ª—ç–∫–¥–∂–µ–∫ */
        .bj-cards {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        .bj-card {
            width: 60px;
            height: 90px;
            background: white;
            color: black;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 24px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        /* –ú–æ–¥–∞–ª–∫–∏ */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--surface);
            border: 1px solid var(--accent);
            border-radius: 32px;
            padding: 24px;
            max-width: 90%;
            width: 400px;
        }

        /* –ü—Ä–æ—á–µ–µ */
        .badge {
            background: var(--accent);
            color: black;
            padding: 4px 12px;
            border-radius: 40px;
            font-size: 12px;
            font-weight: 700;
        }
        .flex { display: flex; gap: 10px; align-items: center; }
        .space-between { display: flex; justify-content: space-between; }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="balance-block">
            <span class="balance-label">–¢–í–û–ô –ë–ê–õ–ê–ù–°</span>
            <span class="balance-value" id="balance">0.00</span>
        </div>
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="pps">0.00</div>
                <div class="stat-label">PPS</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="energy">0</div>
                <div class="stat-label">‚ö°</div>
            </div>
        </div>
    </div>

    <div class="lvl-container">
        <div class="lvl-header">
            <span>RANK: <span id="rank-name">NOVICE</span></span>
            <span>LVL <span id="lvl-val">1</span></span>
        </div>
        <div class="lvl-bar-bg"><div id="lvl-progress"></div></div>
    </div>

    <!-- –ö–û–ù–¢–ï–ù–¢ –¢–ê–ë–û–í -->
    <div id="tab-farm" class="tab-content active-tab">
        <div class="glass-card" style="text-align: center; padding: 30px;">
            <div id="coin" style="width:180px; height:180px; background:radial-gradient(circle at 30% 30%, #ffeaa7, #fdcb6e); border-radius:50%; margin:0 auto 20px; display:flex; align-items:center; justify-content:center; font-size:60px; box-shadow:0 0 50px #fdcb6e; cursor:pointer;">üíé</div>
            <div id="energy-timer" style="color: var(--text-secondary); margin-bottom: 10px;">‚ö° –ó–∞—Ä—è–∂–∞–µ—Ç—Å—è...</div>
            <div style="height: 8px; background: #2d3436; border-radius: 4px;">
                <div id="nrg-bar" style="height:100%; background: linear-gradient(90deg, #00b894, var(--accent)); width:0%; border-radius:4px;"></div>
            </div>
        </div>
        <div class="glass-card">
            <div class="glass-card-title">üè≠ –ü–ê–°–°–ò–í–ù–´–ô –î–û–•–û–î</div>
            <div class="space-between">
                <span>–¢–µ–∫—É—â–∏–π PPS:</span>
                <span><span id="pps-display">0.00</span> TON/—Å–µ–∫</span>
            </div>
        </div>
    </div>

    <div id="tab-games" class="tab-content">
        <div class="glass-card" onclick="openGame('mines')">
            <div class="flex space-between">
                <span>üí£ MINES</span>
                <span class="badge">–ù–û–í–û–ï</span>
            </div>
            <small>–ù–∞–π–¥–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã, –∏–∑–±–µ–≥–∞–π –±–æ–º–±</small>
        </div>
        <div class="glass-card" onclick="openGame('ladder')">
            <div class="flex space-between">
                <span>ü™ú –õ–ï–°–ï–ù–ö–ê</span>
                <span class="badge">2x</span>
            </div>
            <small>–£–≥–∞–¥–∞–π –ø—É—Ç—å –Ω–∞–≤–µ—Ä—Ö</small>
        </div>
        <div class="glass-card" onclick="openGame('wheel')">
            <div class="flex space-between">
                <span>üé° PvP –†–£–õ–ï–¢–ö–ê</span>
                <span class="badge">–ú–£–õ–¨–¢–ò</span>
            </div>
            <small>–°—Ä–∞–∂–∞–π—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏</small>
        </div>
        <div class="glass-card" onclick="openGame('blackjack')">
            <div class="flex space-between">
                <span>üÉè –ë–õ–≠–ö–î–ñ–ï–ö</span>
                <span class="badge">21</span>
            </div>
            <small>–û–±—ã–≥—Ä–∞–π –¥–∏–ª–µ—Ä–∞</small>
        </div>
    </div>

    <div id="tab-shop" class="tab-content">
        <h2>üè™ –ú–ê–ì–ê–ó–ò–ù –§–ï–†–ú</h2>
        <div class="glass-card">
            <div class="space-between">
                <div>
                    <div>üå± –ú–∞–ª–µ–Ω—å–∫–∞—è —Ñ–µ—Ä–º–∞</div>
                    <small>+0.1 PPS</small>
                </div>
                <div>
                    <div>100 TON</div>
                    <button class="btn btn-primary" style="padding:8px 16px;" onclick="buyFarm('small')">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
        </div>
        <div class="glass-card">
            <div class="space-between">
                <div>
                    <div>üå≥ –ë–æ–ª—å—à–∞—è —Ñ–µ—Ä–º–∞</div>
                    <small>+0.5 PPS</small>
                </div>
                <div>
                    <div>450 TON</div>
                    <button class="btn btn-primary" style="padding:8px 16px;" onclick="buyFarm('big')">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
        </div>
        <div class="glass-card">
            <div class="space-between">
                <div>
                    <div>üíé VIP –°–¢–ê–¢–£–°</div>
                    <small>–≠–Ω–µ—Ä–≥–∏—è x40, —É—Å–∫–æ—Ä–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ</small>
                </div>
                <div>
                    <div>5000 TON</div>
                    <button class="btn btn-success" style="padding:8px 16px;" onclick="buyVIP()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-profile" class="tab-content">
        <div class="glass-card">
            <div class="glass-card-title">üë§ –ü–†–û–§–ò–õ–¨</div>
            <div class="space-between">
                <span>ID:</span>
                <span id="user-id">-</span>
            </div>
            <div class="space-between">
                <span>VIP:</span>
                <span id="vip-status">‚ùå –ù–µ—Ç</span>
            </div>
            <div class="space-between">
                <span>–†–µ—Ñ–µ—Ä–∞–ª–æ–≤:</span>
                <span id="referrals-count">0</span>
            </div>
            <button class="btn" onclick="copyRefLink()">üîó –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞</button>
            <button class="btn" onclick="openPromoModal()">üéü –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
            <!-- –ê–¥–º–∏–Ω–∫–∞ –≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º -->
            <div id="admin-section" style="display: none; margin-top: 20px;">
                <div class="glass-card-title">‚öôÔ∏è –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨</div>
                <input type="number" id="admin-user-id" class="input-dark" placeholder="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                <input type="number" id="admin-amount" class="input-dark" placeholder="–°—É–º–º–∞ TON">
                <button class="btn btn-success" onclick="adminGiveTon()">–í—ã–¥–∞—Ç—å TON</button>
                <button class="btn btn-primary" onclick="adminGiveVip()">–í—ã–¥–∞—Ç—å VIP</button>
                <hr style="border-color:var(--border); margin:15px 0;">
                <input type="text" id="promo-code" class="input-dark" placeholder="–ö–æ–¥">
                <input type="number" id="promo-reward" class="input-dark" placeholder="–ù–∞–≥—Ä–∞–¥–∞ TON">
                <input type="number" id="promo-max" class="input-dark" placeholder="–ú–∞–∫—Å. –∞–∫—Ç–∏–≤–∞—Ü–∏–π" value="1">
                <button class="btn" onclick="adminCreatePromo()">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
            </div>
        </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="nav-bar">
        <div class="nav-item active" onclick="switchTab('farm', this)"><i>‚õèÔ∏è</i>–ú–ê–ô–ù–ò–ù–ì</div>
        <div class="nav-item" onclick="switchTab('games', this)"><i>üé≤</i>–ò–ì–†–´</div>
        <div class="nav-item" onclick="switchTab('shop', this)"><i>üè™</i>–ú–ê–ì–ê–ó–ò–ù</div>
        <div class="nav-item" onclick="switchTab('profile', this)"><i>üë§</i>–ü–†–û–§–ò–õ–¨</div>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω (–≤—Å–ø–ª—ã–≤–∞–µ—Ç) -->
    <div id="game-screen" class="modal">
        <div class="modal-content">
            <h2 id="game-title"></h2>
            <div id="game-area"></div>
            <div id="game-info" style="margin: 15px 0; font-weight: bold;"></div>
            <button id="game-cashout" class="btn btn-success" style="display:none;" onclick="doCashout()">–ó–ê–ë–†–ê–¢–¨</button>
            <button class="btn" onclick="closeGame()">–ó–ê–ö–†–´–¢–¨</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ -->
    <div id="promo-modal" class="modal">
        <div class="modal-content">
            <h3>–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞</h3>
            <input type="text" id="promo-input" class="input-dark" placeholder="–í–≤–µ–¥–∏ –∫–æ–¥">
            <button class="btn btn-primary" onclick="activatePromo()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn" onclick="closePromoModal()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        // ================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==================
        (function() {
            // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π Telegram
            window.tg = null;
            window.haptic = { impactOccurred: ()=> {}, notificationOccurred: ()=> {} };
            try {
                if (window.Telegram?.WebApp) {
                    tg = window.Telegram.WebApp;
                    tg.expand();
                    haptic = tg.HapticFeedback || haptic;
                }
            } catch (e) { console.warn('TG init fail'); }

            // –î–∞–Ω–Ω—ã–µ
            let saved = {};
            try { saved = JSON.parse(localStorage.getItem('ton_empire_elite')) || {}; } catch { saved = {}; }

            window.db = {
                bal: n(saved.bal, 50),
                totalEarned: n(saved.totalEarned, 0),
                nrg: n(saved.nrg, 250),
                pps: n(saved.pps, 0.01),
                last: n(saved.last, Date.now()),
                vip: saved.vip || false,
                referrals: saved.referrals || [],
                farms: { small: saved.farms?.small || 0, big: saved.farms?.big || 0 }
            };

            // –ü—Ä–æ–º–æ–∫–æ–¥—ã (–≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –¥–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º, –Ω–æ —Å–æ–∑–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã)
            window.promoCodes = saved.promoCodes || []; // –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ { code, reward, max, used }

            // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
            window.curGame = { active: false, bet: 0, mult: 1, type: '', data: null, open: 0 };
            window.pot = 0; // –¥–ª—è —Ä—É–ª–µ—Ç–∫–∏

            // –§—É–Ω–∫—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —á–∏—Å–ª–∞
            window.n = (v, f=0) => { let r = parseFloat(v); return isNaN(r) || !isFinite(r) ? f : r; };

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            window.save = () => {
                try {
                    localStorage.setItem('ton_empire_elite', JSON.stringify(db));
                } catch {}
            };

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            window.updateUI = () => {
                let now = Date.now();
                let dt = Math.max(0, (now - db.last) / 1000);

                // –î–æ—Ö–æ–¥ —Å —Ñ–µ—Ä–º
                let farmPps = (db.farms.small * 0.1) + (db.farms.big * 0.5);
                db.pps = 0.01 + farmPps; // –±–∞–∑–æ–≤—ã–π 0.01

                let income = db.pps * dt;
                db.bal += income;
                db.totalEarned += income;

                // –≠–Ω–µ—Ä–≥–∏—è
                let maxN = db.vip ? 10000 : 250;
                let reg = db.vip ? 1.0 : 0.25;
                if (db.nrg < maxN) db.nrg = Math.min(maxN, db.nrg + dt * reg);

                // –£—Ä–æ–≤–Ω–∏
                let lvl = Math.floor(db.totalEarned / 500) + 1;
                let progress = ((db.totalEarned % 500) / 500) * 100;

                setText('balance', db.bal.toFixed(2));
                setText('pps', db.pps.toFixed(3));
                setText('pps-display', db.pps.toFixed(3));
                setText('energy', Math.floor(db.nrg));
                let nrgBar = byId('nrg-bar');
                if (nrgBar) nrgBar.style.width = (db.nrg / maxN * 100) + '%';
                setText('lvl-val', lvl);
                let lvlProgress = byId('lvl-progress');
                if (lvlProgress) lvlProgress.style.width = progress + '%';
                setText('rank-name', lvl > 10 ? 'ELITE' : 'NOVICE');
                setText('vip-status', db.vip ? '‚úÖ –ï—Å—Ç—å' : '‚ùå –ù–µ—Ç');
                setText('referrals-count', db.referrals.length);

                // –¢–∞–π–º–µ—Ä —ç–Ω–µ—Ä–≥–∏–∏
                let remain = (maxN - db.nrg) / reg;
                if (db.nrg >= maxN) setText('energy-timer', '‚ö° –≠–Ω–µ—Ä–≥–∏—è –ø–æ–ª–Ω–∞');
                else setText('energy-timer', `‚ö° –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: ${Math.floor(remain/60)}:${Math.floor(remain%60).toString().padStart(2,'0')}`);

                db.last = now;
                save();
            };

            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
            window.byId = (id) => document.getElementById(id);
            window.setText = (id, txt) => { let el = byId(id); if(el) el.innerText = txt; };

            // –ú–æ–Ω–µ—Ç–∫–∞
            let coin = byId('coin');
            if (coin) coin.onclick = () => {
                if (db.nrg >= 1) {
                    db.nrg--;
                    db.bal += 0.01;
                    db.totalEarned += 0.01;
                    try { haptic.impactOccurred('light'); } catch {}
                    updateUI();
                }
            };

            // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            let uid = tg?.initDataUnsafe?.user?.id || 0;
            setText('user-id', uid);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω–∫—É –µ—Å–ª–∏ ID –≤ —Å–ø–∏—Å–∫–µ
            if ([8388334620, 7177436669].includes(uid)) {
                byId('admin-section').style.display = 'block';
            }

            // –ó–∞–ø—É—Å–∫
            updateUI();
            setInterval(updateUI, 1000);
        })();

        // ================== –ù–ê–í–ò–ì–ê–¶–ò–Ø ==================
        window.switchTab = (tabName, el) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            byId('tab-' + tabName).classList.add('active-tab');
            if (el) el.classList.add('active');
        };

        // ================== –ò–ì–†–´ ==================
        window.openGame = (type) => {
            let gameScreen = byId('game-screen');
            let title = byId('game-title');
            let area = byId('game-area');
            gameScreen.classList.add('active');
            curGame.type = type;
            curGame.active = false;

            if (type === 'mines') {
                title.innerText = 'üí£ MINES';
                area.innerHTML = `
                    <input type="number" id="mines-bet" class="input-dark" value="10" placeholder="–°—Ç–∞–≤–∫–∞">
                    <input type="number" id="mines-count" class="input-dark" value="3" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω (1-24)">
                    <button class="btn btn-primary" onclick="startMines()">–ù–ê–ß–ê–¢–¨</button>
                    <div id="mines-grid" class="mines-grid"></div>
                `;
            } else if (type === 'ladder') {
                title.innerText = 'ü™ú –õ–ï–°–ï–ù–ö–ê';
                area.innerHTML = `
                    <input type="number" id="ladder-bet" class="input-dark" value="10" placeholder="–°—Ç–∞–≤–∫–∞">
                    <button class="btn btn-primary" onclick="startLadder()">–ù–ê–ß–ê–¢–¨</button>
                    <div id="ladder-grid"></div>
                `;
            } else if (type === 'wheel') {
                title.innerText = 'üé° PvP –†–£–õ–ï–¢–ö–ê';
                area.innerHTML = `
                    <input type="number" id="wheel-bet" class="input-dark" value="10" placeholder="–°—Ç–∞–≤–∫–∞">
                    <button class="btn btn-primary" onclick="startWheel()">–°–î–ï–õ–ê–¢–¨ –°–¢–ê–í–ö–£</button>
                    <div style="margin-top:15px;">
                        <div id="wheel-timer" style="font-size:20px; color:var(--accent);">–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...</div>
                        <div id="wheel-pot">–ë–∞–Ω–∫: 0.00 TON</div>
                    </div>
                `;
            } else if (type === 'blackjack') {
                title.innerText = 'üÉè –ë–õ–≠–ö–î–ñ–ï–ö';
                area.innerHTML = `
                    <input type="number" id="bj-bet" class="input-dark" value="10" placeholder="–°—Ç–∞–≤–∫–∞">
                    <button class="btn btn-primary" onclick="startBlackjack()">–ù–ê–ß–ê–¢–¨</button>
                    <div id="bj-game"></div>
                `;
            }
        };

        window.closeGame = () => {
            byId('game-screen').classList.remove('active');
            curGame.active = false;
        };

        // ---------- MINES ----------
        window.startMines = () => {
            let bet = n(byId('mines-bet')?.value);
            let mines = Math.min(24, Math.max(1, parseInt(byId('mines-count')?.value) || 1));
            if (bet <= 0 || bet > db.bal) return alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞');
            db.bal -= bet;
            try { haptic.impactOccurred('medium'); } catch {}
            curGame = { active: true, bet, mult: 1, type: 'mines', data: Array(25).fill(false), open: 0 };
            let p = 0;
            while (p < mines) {
                let r = Math.floor(Math.random() * 25);
                if (!curGame.data[r]) { curGame.data[r] = true; p++; }
            }
            let grid = byId('mines-grid');
            grid.innerHTML = '';
            for (let i = 0; i < 25; i++) {
                let cell = document.createElement('div');
                cell.className = 'm-cell';
                cell.innerText = '?';
                cell.onclick = () => {
                    if (!curGame.active || cell.classList.contains('opened')) return;
                    cell.classList.add('opened');
                    if (curGame.data[i]) {
                        cell.innerText = 'üí£';
                        cell.classList.add('open-bomb');
                        curGame.active = false;
                        try { haptic.notificationOccurred('error'); } catch {}
                        byId('game-cashout').style.display = 'none';
                        byId('game-info').innerText = 'üí• –¢—ã –≤–∑–æ—Ä–≤–∞–ª—Å—è! –ü–æ—Ç–µ—Ä—è–Ω–æ: ' + curGame.bet.toFixed(2);
                    } else {
                        cell.innerText = 'üíé';
                        cell.classList.add('open-gem');
                        curGame.open++;
                        curGame.mult *= (1 + (mines / (25 - curGame.open)));
                        try { haptic.impactOccurred('light'); } catch {}
                        byId('game-info').innerText = `üí∞ x${curGame.mult.toFixed(2)} = ${(curGame.bet * curGame.mult).toFixed(2)} TON`;
                        byId('game-cashout').style.display = 'block';
                    }
                };
                grid.appendChild(cell);
            }
            updateUI();
        };

        // ---------- –õ–ï–°–ï–ù–ö–ê (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è) ----------
        window.startLadder = () => {
            let bet = n(byId('ladder-bet')?.value);
            if (bet <= 0 || bet > db.bal) return alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞');
            db.bal -= bet;
            try { haptic.impactOccurred('medium'); } catch {}
            curGame = { active: true, bet, mult: 1, type: 'ladder', step: 0, path: [] };
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø—É—Ç—å (0 –∏–ª–∏ 1 –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è)
            for (let i = 0; i < 6; i++) curGame.path.push(Math.floor(Math.random() * 2));
            let html = '';
            for (let i = 0; i < 6; i++) {
                html += `<div class="ladder-row ${i > 0 ? 'locked' : ''}" id="ladder-row-${i}">`;
                html += `<div class="l-cell" onclick="ladderStep(${i}, 0)">?</div>`;
                html += `<div class="l-cell" onclick="ladderStep(${i}, 1)">?</div>`;
                html += '</div>';
            }
            byId('ladder-grid').innerHTML = html;
        };

        window.ladderStep = (row, choice) => {
            if (!curGame.active || row !== curGame.step) return;
            if (choice === curGame.path[row]) {
                // –ø—Ä–æ–∏–≥—Ä—ã—à
                document.querySelectorAll(`#ladder-row-${row} .l-cell`).forEach(c => c.style.background = '#d63031');
                curGame.active = false;
                byId('game-info').innerText = '‚ùå –¢—ã —É–ø–∞–ª!';
                byId('game-cashout').style.display = 'none';
                try { haptic.notificationOccurred('error'); } catch {}
            } else {
                // –≤—ã–∏–≥—Ä—ã—à
                let cells = document.querySelectorAll(`#ladder-row-${row} .l-cell`);
                cells[choice].style.background = '#00b894';
                cells[choice].innerText = 'üíé';
                curGame.mult *= 2.1;
                curGame.step++;
                byId('game-info').innerText = `üí∞ x${curGame.mult.toFixed(2)} = ${(curGame.bet * curGame.mult).toFixed(2)} TON`;
                byId('game-cashout').style.display = 'block';
                if (curGame.step < 6) {
                    byId(`ladder-row-${curGame.step}`).classList.remove('locked');
                } else {
                    // –¥–æ—à–ª–∏ –¥–æ –≤–µ—Ä—Ö–∞
                    curGame.active = false;
                    doCashout(); // –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–±–∏—Ä–∞–µ–º
                }
                try { haptic.impactOccurred('light'); } catch {}
            }
        };

        // ---------- PvP –†–£–õ–ï–¢–ö–ê (–∏–º–∏—Ç–∞—Ü–∏—è —Å –±–æ—Ç–æ–º) ----------
        window.startWheel = () => {
            let bet = n(byId('wheel-bet')?.value);
            if (bet < 1 || bet > db.bal) return alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞');
            db.bal -= bet;
            pot = bet; // –≤ —Ä–µ–∞–ª—å–Ω–æ–º –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–µ pot –±—ã–ª –±—ã –æ–±—â–∏–º
            setText('wheel-pot', `–ë–∞–Ω–∫: ${pot.toFixed(2)} TON`);
            try { haptic.notificationOccurred('success'); } catch {}

            let timer = 5;
            let interval = setInterval(() => {
                setText('wheel-timer', `üé≤ –†–æ–∑—ã–≥—Ä—ã—à —á–µ—Ä–µ–∑ ${timer}—Å`);
                timer--;
                if (timer < 0) {
                    clearInterval(interval);
                    let win = Math.random() > 0.5; // 50% –Ω–∞ –ø–æ–±–µ–¥—É
                    if (win) {
                        let prize = pot * 1.8;
                        db.bal += prize;
                        db.totalEarned += prize;
                        alert('üéâ –¢—ã –≤—ã–∏–≥—Ä–∞–ª! +' + prize.toFixed(2));
                    } else {
                        alert('üò¢ –¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª...');
                    }
                    closeGame();
                    updateUI();
                }
            }, 1000);
        };

        // ---------- –ë–õ–≠–ö–î–ñ–ï–ö (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π) ----------
        window.startBlackjack = () => {
            let bet = n(byId('bj-bet')?.value);
            if (bet <= 0 || bet > db.bal) return alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞');
            db.bal -= bet;
            curGame = { active: true, bet, type: 'bj', player: [], dealer: [] };
            // –†–∞–∑–¥–∞—á–∞
            curGame.player.push(Math.floor(Math.random() * 10) + 2);
            curGame.player.push(Math.floor(Math.random() * 10) + 2);
            curGame.dealer.push(Math.floor(Math.random() * 10) + 2);
            renderBlackjack();
        };

        window.renderBlackjack = () => {
            let html = '<div class="bj-cards">';
            curGame.player.forEach(c => html += `<div class="bj-card">${c}</div>`);
            html += '</div><div>–î–∏–ª–µ—Ä: ';
            curGame.dealer.forEach(c => html += `<span class="badge">${c}</span> `);
            html += '</div>';
            if (curGame.active) {
                html += '<button class="btn" onclick="bjHit()">–ï—â—ë</button>';
                html += '<button class="btn btn-success" onclick="bjStand()">–•–≤–∞—Ç–∏—Ç</button>';
            }
            byId('bj-game').innerHTML = html;
        };

        window.bjHit = () => {
            curGame.player.push(Math.floor(Math.random() * 10) + 2);
            let sum = curGame.player.reduce((a,b)=>a+b,0);
            if (sum > 21) {
                curGame.active = false;
                byId('game-info').innerText = 'üí• –ü–µ—Ä–µ–±–æ—Ä! –¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª.';
                byId('game-cashout').style.display = 'none';
                try { haptic.notificationOccurred('error'); } catch {}
            }
            renderBlackjack();
        };

        window.bjStand = () => {
            // –î–∏–ª–µ—Ä –¥–æ–±–∏—Ä–∞–µ—Ç –¥–æ 17
            while (curGame.dealer.reduce((a,b)=>a+b,0) < 17) {
                curGame.dealer.push(Math.floor(Math.random() * 10) + 2);
            }
            let playerSum = curGame.player.reduce((a,b)=>a+b,0);
            let dealerSum = curGame.dealer.reduce((a,b)=>a+b,0);
            curGame.active = false;
            if (dealerSum > 21 || playerSum > dealerSum) {
                let win = curGame.bet * 2;
                db.bal += win;
                db.totalEarned += win;
                byId('game-info').innerText = 'üéâ –¢—ã –≤—ã–∏–≥—Ä–∞–ª! +' + win.toFixed(2);
                try { haptic.notificationOccurred('success'); } catch {}
            } else if (playerSum === dealerSum) {
                db.bal += curGame.bet; // –≤–æ–∑–≤—Ä–∞—Ç
                byId('game-info').innerText = 'ü§ù –ù–∏—á—å—è';
            } else {
                byId('game-info').innerText = 'üò¢ –ü—Ä–æ–∏–≥—Ä—ã—à';
                try { haptic.notificationOccurred('error'); } catch {}
            }
            renderBlackjack();
            byId('game-cashout').style.display = 'none'; // –¥–µ–Ω—å–≥–∏ —É–∂–µ –∑–∞—á–∏—Å–ª–µ–Ω—ã
        };

        // ---------- –ö–≠–®–ê–£–¢ ----------
        window.doCashout = () => {
            if (!curGame.active) return;
            let win = curGame.bet * curGame.mult;
            db.bal += win;
            db.totalEarned += win;
            curGame.active = false;
            alert('üí∞ –ó–∞–±—Ä–∞–Ω–æ: ' + win.toFixed(2));
            closeGame();
            updateUI();
        };

        // ================== –ú–ê–ì–ê–ó–ò–ù ==================
        window.buyFarm = (type) => {
            if (type === 'small' && db.bal >= 100) {
                db.bal -= 100;
                db.farms.small++;
                alert('üå± –ú–∞–ª–µ–Ω—å–∫–∞—è —Ñ–µ—Ä–º–∞ –∫—É–ø–ª–µ–Ω–∞!');
            } else if (type === 'big' && db.bal >= 450) {
                db.bal -= 450;
                db.farms.big++;
                alert('üå≥ –ë–æ–ª—å—à–∞—è —Ñ–µ—Ä–º–∞ –∫—É–ø–ª–µ–Ω–∞!');
            } else {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON');
            }
            updateUI();
        };

        window.buyVIP = () => {
            if (db.bal >= 5000 && !db.vip) {
                db.bal -= 5000;
                db.vip = true;
                alert('üíé VIP –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –¢–µ–±–µ –æ—Ç–∫—Ä—ã—Ç—ã –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.');
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ª–∏—á–∫—É —Å @fresei (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
                if (tg) tg.openTelegramLink('https://t.me/fresei');
                else window.open('https://t.me/fresei');
            } else if (db.vip) alert('VIP —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω');
            else alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON');
            updateUI();
        };

        // ================== –†–ï–§–ï–†–ê–õ–´ ==================
        window.copyRefLink = () => {
            let link = `https://t.me/your_bot?start=ref_${tg?.initDataUnsafe?.user?.id || 0}`;
            navigator.clipboard.writeText(link).then(() => alert('üîó –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!'));
        };

        // ================== –ü–†–û–ú–û–ö–û–î–´ ==================
        window.openPromoModal = () => {
            byId('promo-modal').classList.add('active');
        };
        window.closePromoModal = () => {
            byId('promo-modal').classList.remove('active');
        };
        window.activatePromo = () => {
            let code = byId('promo-input').value.trim().toUpperCase();
            let promo = promoCodes.find(p => p.code === code);
            if (!promo) return alert('–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
            if (promo.used >= promo.max) return alert('–ü—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω');
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª –ª–∏ —É–∂–µ —ç—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            let activated = saved.activatedPromos || [];
            if (activated.includes(code)) return alert('–¢—ã —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª —ç—Ç–æ—Ç –∫–æ–¥');
            // –ù–∞—á–∏—Å–ª—è–µ–º
            db.bal += promo.reward;
            promo.used++;
            activated.push(code);
            saved.activatedPromos = activated;
            save();
            alert(`‚úÖ –ü–æ–ª—É—á–µ–Ω–æ ${promo.reward} TON!`);
            closePromoModal();
            updateUI();
        };

        // ================== –ê–î–ú–ò–ù–ö–ê ==================
        window.adminGiveTon = () => {
            let targetId = byId('admin-user-id').value;
            let amount = n(byId('admin-amount').value);
            if (!targetId || amount <= 0) return alert('–í–≤–µ–¥–∏ ID –∏ —Å—É–º–º—É');
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –±—ç–∫–µ–Ω–¥–µ —Ç—É—Ç –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É.
            // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–∏—Å–ª–∏–º —Å–µ–±–µ (–∏–º–∏—Ç–∞—Ü–∏—è)
            db.bal += amount;
            alert(`–í—ã–¥–∞–Ω–æ ${amount} TON –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${targetId} (—Å–∏–º—É–ª—è—Ü–∏—è)`);
            updateUI();
        };

        window.adminGiveVip = () => {
            let targetId = byId('admin-user-id').value;
            // –ò–º–∏—Ç–∞—Ü–∏—è –≤—ã–¥–∞—á–∏ VIP
            alert(`VIP –≤—ã–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${targetId} (—Å–∏–º—É–ª—è—Ü–∏—è)`);
        };

        window.adminCreatePromo = () => {
            let code = byId('promo-code').value.trim().toUpperCase();
            let reward = n(byId('promo-reward').value);
            let max = n(byId('promo-max').value, 1);
            if (!code || reward <= 0) return alert('–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è');
            promoCodes.push({ code, reward, max, used: 0 });
            save();
            alert(`–ü—Ä–æ–º–æ–∫–æ–¥ ${code} —Å–æ–∑–¥–∞–Ω!`);
        };
    </script>
</body>
</html>
