<!DOCTYPE html>
<html>
<head>
    <title>–ú–æ–µ TON –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
    </head>
<body>

    <h1 id="balance">0</h1>
    <button onclick="startM()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>

    <script>
        // –í–µ—Å—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —è –¥–∞–ª –≤—ã—à–µ, –∫–æ–ø–∏—Ä—É–π —Å—é–¥–∞
        <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram API
    let tg = window.Telegram.WebApp;
    tg.ready(); // –°–æ–æ–±—â–∞–µ–º Telegram, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ (—É–±–∏—Ä–∞–µ—Ç —Å–µ—Ä—ã–π —ç–∫—Ä–∞–Ω)
    tg.expand(); // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

    let userId = tg.initDataUnsafe?.user?.id || 0;
    
    // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —á–∏—Å–ª–æ
    function n(val, fallback = 0) {
        let num = parseFloat(val);
        return isNaN(num) || !isFinite(num) ? fallback : num;
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
    function setText(id, text) {
        const el = document.getElementById(id);
        if (el) el.innerText = text;
    }

    let today = new Date().toLocaleDateString();
    let saved = {};
    try {
        saved = JSON.parse(localStorage.getItem('ton_final_elite')) || {};
    } catch(e) { saved = {}; }
    
    let db = {
        bal: n(saved.bal, 50),
        nrg: n(saved.nrg, 250),
        pps: n(saved.pps, 0),
        clk: n(saved.clk, 0),
        last: n(saved.last, Date.now()),
        vip: saved.vip || false,
        daily: n(saved.daily, 0),
        q_date: saved.q_date || today,
        q_list: saved.q_list || [false, false, false, false, false]
    };

    if(db.q_date !== today) {
        db.q_list = [false, false, false, false, false];
        db.q_date = today;
    }

    let cur = { active: false, bet: 0, mult: 1, type: '', data: null, step: 0 };

    function save() { 
        db.bal = n(db.bal, 0);
        localStorage.setItem('ton_final_elite', JSON.stringify(db)); 
    }

    function update() {
        let now = Date.now();
        let dt = Math.max(0, (now - db.last) / 1000);
        
        // –ù–∞—á–∏—Å–ª—è–µ–º –ø–∞—Å—Å–∏–≤–∫—É
        db.bal = n(db.bal + (n(db.pps) * dt));
        
        let maxN = db.vip ? 10000 : 250;
        let reg = db.vip ? 1.0 : 0.25;
        
        if(db.nrg < maxN) {
            db.nrg = Math.min(maxN, db.nrg + (dt * reg));
            let remain = (maxN - db.nrg) / reg;
            let m = Math.floor(remain / 60);
            let s = Math.floor(remain % 60);
            setText('energy-timer', `–§—É–ª–ª —ç–Ω–µ—Ä–≥–∏—è —á–µ—Ä–µ–∑: ${m}:${s < 10 ? '0'+s : s}`);
        } else {
            setText('energy-timer', "–ó–∞—Ä—è–∂–µ–Ω–æ –Ω–∞ 100%");
        }

        db.last = now;
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        setText('balance', n(db.bal).toFixed(2));
        setText('pps', n(db.pps).toFixed(2));
        setText('energy', Math.floor(n(db.nrg)));
        
        const nrgBar = document.getElementById('nrg-bar');
        if (nrgBar) nrgBar.style.width = (n(db.nrg)/maxN*100)+'%';
        
        // –ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è renderQuests, –≤—ã–∑—ã–≤–∞–π –µ—ë —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫—É
        if (typeof renderQuests === "function") renderQuests();
        save();
    }

    // –ò–≥—Ä—ã (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –∑–∞—â–∏—Ç–æ–π)
    function startM() {
        let input = document.getElementById('mb')?.value;
        let b = n(input, 0);
        let c = parseInt(document.getElementById('mc')?.value || 3);

        if (b <= 0) return alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç–∞–≤–∫—É!");
        if (b > db.bal) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞!");

        db.bal -= b;
        cur = { active: true, bet: b, mult: 1, type: 'mines', data: Array(25).fill(false) };
        let p=0; while(p<c){let r=Math.floor(Math.random()*25); if(!cur.data[r]){cur.data[r]=true; p++;}}
        
        let grid = document.getElementById('m-grid'); 
        if (!grid) return;
        
        grid.innerHTML = '';
        for(let i=0; i<25; i++) {
            let d = document.createElement('div'); 
            d.className = 'm-cell'; d.innerText = '?';
            d.onclick = () => {
                if(!cur.active || d.innerText !== '?') return;
                if(cur.data[i]) { 
                    d.innerText = 'üí£'; d.classList.add('open-bomb'); cur.active = false; 
                    if(document.getElementById('btn-cashout')) document.getElementById('btn-cashout').style.display = 'none';
                    setText('g-info', "–í–ó–†–´–í! –ü–æ—Ç–µ—Ä—è–Ω–æ: " + cur.bet.toFixed(2));
                }
                else { 
                    d.innerText = 'üíé'; d.classList.add('open-gem'); 
                    cur.mult += (c/4)+0.3; 
                    setText('g-info', `–ö—É—à: ${(cur.bet*cur.mult).toFixed(2)} TON`); 
                    if(document.getElementById('btn-cashout')) document.getElementById('btn-cashout').style.display = 'block'; 
                }
            }; grid.appendChild(d);
        }
        update();
    }

    // –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞
    setInterval(update, 1000);
    update();
</script>
        console.log("–°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω!");
    </script>
</body>
</html>
