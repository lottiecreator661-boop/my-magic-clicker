// –î–æ–±–∞–≤—å —ç—Ç–æ –≤ –Ω–∞—á–∞–ª–æ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∏–±—Ä–∞—Ü–∏–µ–π Telegram
let haptic = tg.HapticFeedback;

function uiG(t) {
    document.getElementById('g-list').style.display = 'none';
    document.getElementById('g-play').style.display = 'block';
    let area = document.getElementById('g-area');
    cur.type = t;
    document.getElementById('g-info').innerText = "–£–¥–∞—á–∏!";
    document.getElementById('btn-cashout').style.display = 'none';

    if(t === 'mines') {
        document.getElementById('g-title').innerText = "üí£ CRYSTAL MINES";
        area.innerHTML = `
            <div class="glass-card">
                <input type="number" id="mb" class="input-dark" placeholder="–°—Ç–∞–≤–∫–∞ TON" value="10">
                <select id="mc" class="input-dark">
                    <option value="3">3 –ë–æ–º–±—ã (x1.2 –∑–∞ –∫–ª–∏–∫)</option>
                    <option value="5">5 –ë–æ–º–± (x1.5 –∑–∞ –∫–ª–∏–∫)</option>
                    <option value="10">10 –ë–æ–º–± (x2.4 –∑–∞ –∫–ª–∏–∫)</option>
                </select>
                <button class="btn btn-blue" onclick="startM()">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
            </div>
            <div id="m-grid" class="mines-grid"></div>
        `;
    } 
    else if(t === 'ladder') {
        document.getElementById('g-title').innerText = "ü™ú LADDER CLIMB";
        area.innerHTML = `
            <div class="glass-card">
                <input type="number" id="lb" class="input-dark" placeholder="–°—Ç–∞–≤–∫–∞" value="10">
                <button class="btn btn-blue" onclick="startL()">–ü–û–î–ù–Ø–¢–¨–°–Ø</button>
            </div>
            <div id="l-grid" class="ladder-grid"></div>
        `;
    }
}

// –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ú–∏–Ω—ã —Å —Ç–∞–∫—Ç–∏–ª—å–Ω–æ–π –æ—Ç–¥–∞—á–µ–π
function startM() {
    let b = n(document.getElementById('mb').value, 0);
    let c = parseInt(document.getElementById('mc').value);

    if (b <= 0 || b > db.bal) return alert("–ü—Ä–æ–≤–µ—Ä—å –±–∞–ª–∞–Ω—Å –∏ —Å—Ç–∞–≤–∫—É!");
    
    db.bal -= b;
    cur = { active: true, bet: b, mult: 1, type: 'mines', data: Array(25).fill(false), open: 0 };
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–æ–º–±
    let p = 0; 
    while(p < c) {
        let r = Math.floor(Math.random()*25); 
        if(!cur.data[r]) { cur.data[r] = true; p++; }
    }
    
    let grid = document.getElementById('m-grid'); 
    grid.innerHTML = '';
    
    for(let i=0; i<25; i++) {
        let d = document.createElement('div');
        d.className = 'm-cell';
        d.innerText = '?';
        d.onclick = () => {
            if(!cur.active || d.classList.contains('opened')) return;
            d.classList.add('opened');
            
            if(cur.data[i]) { 
                haptic.notificationOccurred('error'); // –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ –ø—Ä–æ–∏–≥—Ä—ã—à–µ
                d.innerText = 'üí£'; d.style.background = '#ef4444'; 
                cur.active = false;
                document.getElementById('btn-cashout').style.display = 'none';
                document.getElementById('g-info').innerText = "–ë–£–£–£–ú! - " + cur.bet.toFixed(2);
            } else {
                haptic.impactOccurred('medium'); // –õ–µ–≥–∫–∞—è –≤–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
                d.innerText = 'üíé'; d.style.background = '#0098EA';
                cur.open++;
                // –§–æ—Ä–º—É–ª–∞: —á–µ–º –º–µ–Ω—å—à–µ –∫–ª–µ—Ç–æ–∫ –æ—Å—Ç–∞–ª–æ—Å—å, —Ç–µ–º –≤—ã—à–µ —Ä–∏—Å–∫ –∏ –º–Ω–æ–∂–∏—Ç–µ–ª—å
                cur.mult *= (1 + (c / (25 - cur.open)));
                document.getElementById('g-info').innerText = `–ú–Ω–æ–∂–∏—Ç–µ–ª—å: x${cur.mult.toFixed(2)} (–í—ã–∏–≥—Ä—ã—à: ${(cur.bet*cur.mult).toFixed(2)})`;
                document.getElementById('btn-cashout').style.display = 'block';
            }
        };
        grid.appendChild(d);
    }
    update();
}
