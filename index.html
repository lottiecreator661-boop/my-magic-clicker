<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TON Empire PvP Edition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --accent: #0098EA; --bg: #0b0f1a; --glass: rgba(255, 255, 255, 0.07); }
        body { background: var(--bg); color: #fff; text-align: center; font-family: 'Inter', sans-serif; margin: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }

        /* –®–∞–ø–∫–∞ —Å –û–Ω–ª–∞–π–Ω–æ–º */
        .top-bar { background: rgba(11, 15, 26, 0.8); backdrop-filter: blur(20px); padding: 15px 20px; display: flex; justify-content: space-between; border-bottom: 1px solid var(--glass); }
        .online-tag { font-size: 10px; background: rgba(16, 185, 129, 0.2); color: #10b981; padding: 2px 8px; border-radius: 10px; display: inline-block; margin-bottom: 5px; }
        .balance-val { font-size: 22px; font-weight: 900; color: #fff; text-shadow: 0 0 15px var(--accent); }

        .tab-content { flex-grow: 1; display: none; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; padding-bottom: 120px; }
        .active-tab { display: flex; }

        /* –†—É–ª–µ—Ç–∫–∞ –ê–Ω–∏–º–∞—Ü–∏—è */
        .wheel-container { position: relative; width: 100%; height: 80px; background: #161b2a; border-radius: 15px; overflow: hidden; margin: 20px 0; border: 2px solid var(--glass); }
        .wheel-line { display: flex; position: absolute; left: 0; transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1); will-change: transform; }
        .wheel-item { min-width: 60px; height: 60px; margin: 10px; background: var(--accent); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; }
        .wheel-pointer { position: absolute; top: 0; left: 50%; width: 4px; height: 100%; background: #ff4757; transform: translateX(-50%); z-index: 10; box-shadow: 0 0 10px #ff4757; }

        /* –û—Å—Ç–∞–ª—å–Ω–æ–µ */
        #coin { width: 190px; height: 190px; background: linear-gradient(135deg, #0098EA, #00f2ff); border-radius: 50%; margin: 20px auto; display: flex; align-items: center; justify-content: center; font-size: 60px; cursor: pointer; box-shadow: 0 0 40px rgba(0, 152, 234, 0.4); position: relative; }
        .tap-anim { position: absolute; color: #fff; font-weight: bold; font-size: 26px; pointer-events: none; animation: fly 0.6s forwards; }
        @keyframes fly { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
        
        .glass-card { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 15px; width: 100%; margin-bottom: 12px; box-sizing: border-box; }
        .btn { border: none; padding: 15px; border-radius: 15px; font-weight: 800; color: #fff; cursor: pointer; width: 100%; }
        .btn-blue { background: var(--accent); }
        .input-dark { background: #161b2a; border: 1px solid #2d3748; color: #fff; padding: 12px; border-radius: 12px; width: 90%; margin-bottom: 10px; text-align: center; }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .bottom-nav { background: rgba(11, 15, 26, 0.95); display: flex; justify-content: space-around; padding: 12px 0 35px 0; position: fixed; bottom: 0; width: 100%; border-top: 1px solid var(--glass); }
        .nav-item { color: #64748b; font-size: 11px; cursor: pointer; }
        .nav-item.active { color: var(--accent); }
    </style>
</head>
<body>
    <div class="top-bar">
        <div style="text-align: left;">
            <div class="online-tag">‚óè ONLINE: <span id="online-cnt">542</span></div>
            <div class="balance-val"><span id="balance">0.00</span> <small style="font-size:10px">TON</small></div>
        </div>
        <div style="text-align: right;"><small style="color:#94a3b8">PPS</small><div style="color:#34d399; font-weight:bold;">+<span id="pps">0</span></div></div>
    </div>

    <div id="tab-farm" class="tab-content active-tab">
        <div id="coin">üíé</div>
        <div style="font-size: 28px; font-weight: 900;">‚ö° <span id="energy">250</span></div>
        <div id="energy-timer" style="font-size:12px; color:#94a3b8; margin-top:5px;">–ó–∞—Ä—è–∂–µ–Ω–æ</div>
    </div>

    <div id="tab-games" class="tab-content">
        <div id="g-list" style="width:100%">
            <div class="glass-card" onclick="uiG('mines')">üí£ –ú–ò–ù–´ (–î–æ 10M TON)</div>
            <div class="glass-card" onclick="uiG('ladder')">ü™ú –õ–ï–°–ï–ù–ö–ê (–î–æ 10M TON)</div>
            <div class="glass-card" onclick="uiG('wheel')" style="border-color:#f59e0b">üé° PvP –î–ñ–ï–ö–ü–û–¢</div>
        </div>

        <div id="g-play" style="display:none; width:100%">
            <h2 id="g-title">–ò–ì–†–ê</h2>
            <div id="g-area"></div>
            <div id="g-info" style="margin:10px; color:#f59e0b; font-weight:bold;"></div>
            <button id="btn-cashout" class="btn btn-blue" style="display:none; background:#f59e0b; margin-bottom:10px;" onclick="doCashout()">–ó–ê–ë–†–ê–¢–¨</button>
            <button class="btn" style="background:#334155" onclick="closeG()">–ù–ê–ó–ê–î</button>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchT('farm', this)"><b>‚õè</b><br>–ö–ª–∏–∫</div>
        <div class="nav-item" onclick="switchT('games', this)"><b>üé≤</b><br>–ò–≥—Ä—ã</div>
    </div>

    <script>
        // --- –ë–ê–ó–ê –ò –ó–ê–©–ò–¢–ê –û–¢ NaN ---
        function n(v, f=0) { let res = parseFloat(v); return isNaN(res) ? f : res; }

        let db = JSON.parse(localStorage.getItem('ton_pvp_v1')) || { bal: 100, nrg: 250, pps: 0, clk: 0, last: Date.now(), vip: false };
        let cur = { active: false, bet: 0, mult: 1, type: '' };
        let wheelPot = 0;
        let wheelActive = false;
        let wheelPlayers = [];

        function save() { localStorage.setItem('ton_pvp_v1', JSON.stringify(db)); }

        function update() {
            let now = Date.now();
            let dt = (now - db.last) / 1000;
            db.bal = n(db.bal + (n(db.pps) * dt));
            let maxN = db.vip ? 10000 : 250;
            db.nrg = Math.min(maxN, db.nrg + (dt * 0.2));
            db.last = now;

            document.getElementById('balance').innerText = n(db.bal).toFixed(2);
            document.getElementById('pps').innerText = n(db.pps).toFixed(2);
            document.getElementById('energy').innerText = Math.floor(n(db.nrg));
            document.getElementById('online-cnt').innerText = Math.floor(Math.random() * 50) + 600;
            save();
        }

        // --- –î–ñ–ï–ö–ü–û–¢ PvP ---
        function uiG(t) {
            document.getElementById('g-list').style.display = 'none';
            document.getElementById('g-play').style.display = 'block';
            cur.type = t;
            let area = document.getElementById('g-area');
            
            if(t === 'wheel') {
                document.getElementById('g-title').innerText = "PvP JACKPOT";
                area.innerHTML = `
                    <div class="wheel-container">
                        <div class="wheel-pointer"></div>
                        <div id="w-line" class="wheel-line"></div>
                    </div>
                    <div id="w-status" style="font-size:14px; color:#34d399">–ñ–¥–µ–º —Å—Ç–∞–≤–æ–∫...</div>
                    <div id="w-pot-val" style="font-size:24px; margin:10px 0;">–ë–∞–Ω–∫: 0 TON</div>
                    <input type="number" id="wb" class="input-dark" placeholder="–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞">
                    <button class="btn btn-blue" onclick="betWheel()">–ü–û–°–¢–ê–í–ò–¢–¨</button>
                `;
                renderWheelItems();
            } else if(t === 'mines') {
                area.innerHTML = `<input type="number" id="mb" class="input-dark" placeholder="–°—Ç–∞–≤–∫–∞"><button class="btn btn-blue" onclick="startM()">–ò–ì–†–ê–¢–¨</button><div id="m-grid" class="mines-grid"></div>`;
            }
        }

        function renderWheelItems() {
            const line = document.getElementById('w-line');
            line.innerHTML = '';
            const icons = ['üíé', 'üí∞', 'üî•', 'üëë', '‚≠ê', 'üçÄ'];
            for(let i=0; i<40; i++) {
                let div = document.createElement('div');
                div.className = 'wheel-item';
                div.innerText = icons[i % icons.length];
                line.appendChild(div);
            }
        }

        function betWheel() {
            let b = n(document.getElementById('wb').value);
            if(b < 1 || b > db.bal) return alert("–û—à–∏–±–∫–∞ —Å—Ç–∞–≤–∫–∏!");
            
            db.bal -= b; wheelPot += b;
            document.getElementById('w-pot-val').innerText = `–ë–∞–Ω–∫: ${wheelPot.toFixed(2)} TON`;
            document.getElementById('w-status').innerText = "–°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞! –ñ–¥–µ–º –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞...";
            
            // –°–∏–º—É–ª—è—Ü–∏—è –≤—Ö–æ–¥–∞ –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ 3 —Å–µ–∫
            setTimeout(() => {
                if(cur.type !== 'wheel') return;
                wheelPot += b * 1.2; // ¬´–°–æ–ø–µ—Ä–Ω–∏–∫¬ª –ø–æ—Å—Ç–∞–≤–∏–ª —Å—Ç–æ–ª—å–∫–æ –∂–µ + —á—É—Ç—å —Å–≤–µ—Ä—Ö—É
                document.getElementById('w-pot-val').innerText = `–ë–∞–Ω–∫: ${wheelPot.toFixed(2)} TON`;
                startCountDown();
            }, 3000);
            update();
        }

        function startCountDown() {
            let s = 10;
            let timer = setInterval(() => {
                if(cur.type !== 'wheel') { clearInterval(timer); return; }
                document.getElementById('w-status').innerText = `–ò–≥—Ä–∞ –Ω–∞—á–Ω–µ—Ç—Å—è —á–µ—Ä–µ–∑ ${s}—Å`;
                s--;
                if(s < 0) {
                    clearInterval(timer);
                    runWheel();
                }
            }, 1000);
        }

        function runWheel() {
            const line = document.getElementById('w-line');
            const shift = Math.floor(Math.random() * 1500) + 1000;
            line.style.transform = `translateX(-${shift}px)`;
            
            setTimeout(() => {
                alert("üéâ –í–´ –í–´–ò–ì–†–ê–õ–ò! –ü—Ä–∏–∑: " + wheelPot.toFixed(2) + " TON");
                db.bal += wheelPot;
                wheelPot = 0;
                line.style.transition = 'none';
                line.style.transform = 'translateX(0)';
                setTimeout(() => line.style.transition = 'transform 4s cubic-bezier(0.15, 0, 0.15, 1)', 50);
                document.getElementById('w-pot-val').innerText = `–ë–∞–Ω–∫: 0 TON`;
                document.getElementById('w-status').innerText = "–ñ–¥–µ–º —Å—Ç–∞–≤–æ–∫...";
                update();
            }, 4500);
        }

        // –ö–õ–ò–ö–ï–†
        document.getElementById('coin').onclick = (e) => {
            if(db.nrg >= 1) {
                db.nrg--; db.bal += 0.5;
                let a = document.createElement('div');
                a.className = 'tap-anim'; a.innerText = '+0.5';
                a.style.left = e.clientX + 'px'; a.style.top = e.clientY + 'px';
                document.body.appendChild(a);
                setTimeout(() => a.remove(), 600);
                update();
            }
        };

        function switchT(id, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('tab-' + id).classList.add('active-tab');
            el.classList.add('active');
        }

        function closeG() { document.getElementById('g-list').style.display = 'block'; document.getElementById('g-play').style.display = 'none'; }

        setInterval(update, 1000);
        update();
    </script>
</body>
</html>
