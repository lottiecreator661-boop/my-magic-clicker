<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TON Empire Fix</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --accent: #0098EA; --glass: rgba(255, 255, 255, 0.1); --bg: #0f172a; }
        body {
            background: radial-gradient(circle at top, #1e1b4b, var(--bg));
            color: #fff; text-align: center; font-family: 'Segoe UI', sans-serif;
            margin: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh;
        }

        .top-bar { background: rgba(0,0,0,0.3); backdrop-filter: blur(15px); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--glass); }
        .balance-val { font-size: 24px; font-weight: bold; color: var(--accent); }

        .tab-content { flex-grow: 1; display: none; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; width: 100%; box-sizing: border-box; padding-bottom: 100px; }
        .active-tab { display: flex; }

        /* –ò–ì–†–´ –ö–ê–†–¢–û–ß–ö–ò */
        .glass-card { background: var(--glass); border: 1px solid var(--glass); border-radius: 18px; padding: 15px; width: 90%; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }

        /* –ú–ò–ù–´ –ì–†–ò–î */
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin: 15px 0; }
        .m-cell { width: 50px; height: 50px; background: #334155; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .m-cell.open-gem { background: #10b981; }
        .m-cell.open-bomb { background: #ef4444; }

        /* –õ–ï–°–ï–ù–ö–ê –ì–†–ò–î */
        .ladder-grid { display: flex; flex-direction: column-reverse; gap: 8px; width: 250px; }
        .ladder-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .ladder-row.locked { opacity: 0.3; pointer-events: none; }
        .l-cell { background: #334155; padding: 15px; border-radius: 10px; font-weight: bold; border: 2px solid transparent; }

        /* –ö–ù–û–ü–ö–ò –ò –í–í–û–î */
        .input-dark { background: #0f172a; border: 1px solid #334155; color: #fff; padding: 10px; border-radius: 10px; width: 85%; margin-bottom: 10px; text-align: center; }
        .btn { border: none; padding: 12px; border-radius: 12px; font-weight: bold; color: #fff; width: 100%; cursor: pointer; }
        .btn-blue { background: var(--accent); }
        .btn-orange { background: #f59e0b; margin-top: 10px; }
        .btn-red { background: #ef4444; margin-top: 10px; }

        .bottom-nav { background: #0f172a; border-top: 1px solid var(--glass); display: flex; justify-content: space-around; padding: 10px 0 25px 0; position: fixed; bottom: 0; width: 100%; }
        .nav-item { color: #94a3b8; font-size: 11px; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--accent); }
    </style>
</head>
<body>

    <div class="top-bar">
        <div><small>–ë–ê–õ–ê–ù–°</small><div class="balance-val">üíé <span id="balance">0</span></div></div>
        <div style="text-align: right;"><small>PPS</small><div style="color:#34d399;">+<span id="pps">0</span></div></div>
    </div>

    <div id="tab-farm" class="tab-content active-tab">
        <div id="coin" style="width:200px; height:200px; background:var(--accent); border-radius:50%; margin:40px auto; display:flex; align-items:center; justify-content:center; font-size:50px; cursor:pointer; box-shadow:0 0 30px var(--accent);">üíé</div>
        <div style="font-size: 24px;">‚ö° <span id="energy">250</span></div>
    </div>

    <div id="tab-mine" class="tab-content">
        <h3>–ú–∞–π–Ω–∏–Ω–≥</h3>
        <div class="glass-card">
            <div><b>GPU Card</b><br><small>+0.02/—Å–µ–∫</small></div>
            <button class="btn btn-blue" style="width:100px" onclick="buyM(50, 0.02)">50 TON</button>
        </div>
    </div>

    <div id="tab-games" class="tab-content">
        <div id="g-list" style="width:100%">
            <div class="glass-card" onclick="uiGame('mines')"><b>üí£ –ú–ò–ù–´</b><span>‚ñ∂</span></div>
            <div class="glass-card" onclick="uiGame('ladder')"><b>ü™ú –õ–ï–°–ï–ù–ö–ê</b><span>‚ñ∂</span></div>
        </div>

        <div id="g-play" style="display:none; width:100%">
            <h2 id="g-title">–ò–≥—Ä–∞</h2>
            <div id="g-area"></div>
            <div id="g-info" style="margin:15px 0; color:#f59e0b; font-weight:bold;"></div>
            <button id="btn-cashout" class="btn btn-orange" style="display:none" onclick="doCashout()">–ó–ê–ë–†–ê–¢–¨</button>
            <button class="btn btn-red" onclick="closeG()">–í–´–ô–¢–ò</button>
        </div>
    </div>

    <div id="tab-admin" class="tab-content">
        <h3>–ê–¥–º–∏–Ω–∫–∞</h3>
        <input type="text" id="adm-id" class="input-dark" placeholder="Username / ID">
        <input type="number" id="adm-v" class="input-dark" placeholder="–°—É–º–º–∞">
        <button class="btn btn-blue" onclick="adm(1)">–î–∞—Ç—å TON</button>
        <button class="btn btn-orange" style="margin-top:10px" onclick="adm(2)">–î–∞—Ç—å VIP</button>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchT('farm', this)"><b>‚õè</b><br>–§–∞—Ä–º</div>
        <div class="nav-item" onclick="switchT('mine', this)"><b>üíª</b><br>–ú–∞–π–Ω–∏–Ω–≥</div>
        <div class="nav-item" onclick="switchT('games', this)"><b>üé≤</b><br>–ò–≥—Ä—ã</div>
        <div id="adm-nav" class="nav-item" style="display:none" onclick="switchT('admin', this)"><b>‚öôÔ∏è</b><br>–ê–¥–º–∏–Ω</div>
    </div>

    <script>
        const ADMINS = [7177436669, 8388334620];
        let tg = window.Telegram.WebApp;
        let userId = tg.initDataUnsafe?.user?.id || 0;
        let db = JSON.parse(localStorage.getItem('ton_fix_final')) || { bal: 100, nrg: 250, pps: 0, last: Date.now(), vip: false };

        let cur = { active: false, bet: 0, mult: 1, type: '', data: null, step: 0 };

        function save() { localStorage.setItem('ton_fix_final', JSON.stringify(db)); }

        function update() {
            let now = Date.now();
            let dt = (now - db.last) / 1000;
            db.bal += db.pps * dt;
            db.nrg = Math.min(db.vip ? 10000 : 250, db.nrg + (dt * (db.vip ? 0.5 : 0.15)));
            db.last = now;
            document.getElementById('balance').innerText = db.bal.toFixed(2);
            document.getElementById('pps').innerText = db.pps.toFixed(2);
            document.getElementById('energy').innerText = Math.floor(db.nrg);
            if(ADMINS.includes(userId)) document.getElementById('adm-nav').style.display = 'block';
            save();
        }

        function switchT(id, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('tab-' + id).classList.add('active-tab');
            el.classList.add('active');
            closeG();
        }

        // --- –ú–ò–ù–´ (–ö–ê–ö –¢–´ –ü–†–û–°–ò–õ) ---
        function uiGame(t) {
            document.getElementById('g-list').style.display = 'none';
            document.getElementById('g-play').style.display = 'block';
            cur.type = t;
            let area = document.getElementById('g-area');
            if(t === 'mines') {
                document.getElementById('g-title').innerText = "–ú–ò–ù–´";
                area.innerHTML = `
                    <input type="number" id="mb" class="input-dark" placeholder="–°—Ç–∞–≤–∫–∞">
                    <select id="mc" class="input-dark">
                        <option value="3">3 –ú–∏–Ω—ã</option><option value="5">5 –ú–∏–Ω</option><option value="10">10 –ú–∏–Ω</option>
                    </select>
                    <button class="btn btn-blue" onclick="startM()">–ò–ì–†–ê–¢–¨</button>
                    <div id="m-grid" class="mines-grid"></div>
                `;
            } else {
                document.getElementById('g-title').innerText = "–õ–ï–°–ï–ù–ö–ê";
                area.innerHTML = `
                    <input type="number" id="lb" class="input-dark" placeholder="–°—Ç–∞–≤–∫–∞">
                    <button class="btn btn-blue" onclick="startL()">–ù–ê–ß–ê–¢–¨</button>
                    <div id="l-grid" class="ladder-grid"></div>
                `;
            }
        }

        function startM() {
            let b = parseFloat(document.getElementById('mb').value);
            let c = parseInt(document.getElementById('mc').value);
            if(b > db.bal || b <= 0) return alert("–ú–∞–ª–æ TON!");
            db.bal -= b; cur = { active: true, bet: b, mult: 1, type: 'mines', data: Array(25).fill(false) };
            let p = 0; while(p < c) { let r = Math.floor(Math.random()*25); if(!cur.data[r]){cur.data[r]=true; p++;} }
            let grid = document.getElementById('m-grid'); grid.innerHTML = '';
            for(let i=0; i<25; i++) {
                let d = document.createElement('div'); d.className = 'm-cell'; d.innerText = '?';
                d.onclick = () => {
                    if(!cur.active || d.innerText !== '?') return;
                    if(cur.data[i]) {
                        d.innerText = 'üí£'; d.className = 'm-cell open-bomb'; cur.active = false;
                        document.getElementById('g-info').innerText = "–ü–†–û–ò–ì–†–ê–õ! –ë–∞–ª–∞–Ω—Å —Å–≥–æ—Ä–µ–ª";
                        document.getElementById('btn-cashout').style.display = 'none';
                    } else {
                        d.innerText = 'üíé'; d.className = 'm-cell open-gem';
                        let step = (c/4) + 0.2; cur.mult += step;
                        document.getElementById('g-info').innerText = `–ó–∞–±–µ—Ä–µ—à—å: ${(cur.bet * cur.mult).toFixed(2)} | –°–ª–µ–¥: x${(cur.mult+step).toFixed(2)}`;
                        document.getElementById('btn-cashout').style.display = 'block';
                    }
                };
                grid.appendChild(d);
            }
            update();
        }

        // --- –õ–ï–°–ï–ù–ö–ê (–ö–ê–ö –¢–´ –ü–†–û–°–ò–õ) ---
        function startL() {
            let b = parseFloat(document.getElementById('lb').value);
            if(b > db.bal || b <= 0) return alert("–ú–∞–ª–æ TON!");
            db.bal -= b; cur = { active: true, bet: b, mult: 1, type: 'ladder', step: 0 };
            let grid = document.getElementById('l-grid'); grid.innerHTML = '';
            for(let i=0; i<6; i++) {
                let row = document.createElement('div'); row.className = 'ladder-row' + (i>0?' locked':'');
                let t = Math.floor(Math.random()*2);
                row.innerHTML = `<div class="l-cell" onclick="stepL(0,${t},${i},this)">?</div><div class="l-cell" onclick="stepL(1,${t},${i},this)">?</div>`;
                grid.appendChild(row);
            }
            update();
        }

        function stepL(ch, tr, idx, el) {
            if(!cur.active || idx !== cur.step) return;
            if(ch === tr) {
                el.innerText = 'üí•'; el.style.background = '#ef4444'; cur.active = false;
                document.getElementById('g-info').innerText = "–£–ü–ê–õ!";
                document.getElementById('btn-cashout').style.display = 'none';
            } else {
                el.innerText = 'üíé'; el.style.background = '#10b981';
                cur.mult *= 2; cur.step++;
                document.getElementById('g-info').innerText = `–í—ã–∏–≥—Ä—ã—à: ${(cur.bet * cur.mult).toFixed(2)}`;
                document.getElementById('btn-cashout').style.display = 'block';
                if(cur.step < 6) document.querySelectorAll('.ladder-row')[cur.step].classList.remove('locked');
            }
        }

        function doCashout() {
            if(!cur.active) return;
            db.bal += cur.bet * cur.mult; cur.active = false;
            alert("–ó–∞–±—Ä–∞–ª " + (cur.bet * cur.mult).toFixed(2));
            closeG(); update();
        }

        function closeG() { 
            document.getElementById('g-list').style.display = 'block'; 
            document.getElementById('g-play').style.display = 'none'; 
            document.getElementById('btn-cashout').style.display = 'none';
            document.getElementById('g-info').innerText = '';
            cur.active = false; 
        }

        function buyM(cost, p) { if(db.bal >= cost){db.bal -= cost; db.pps += p; update();} }
        function adm(mode) {
            let id = document.getElementById('adm-id').value;
            let v = parseFloat(document.getElementById('adm-v').value);
            if(id == userId || id == "@me") {
                if(mode === 1) db.bal += v; else db.vip = true;
                update(); alert("–û–∫!");
            }
        }

        document.getElementById('coin').onclick = () => {
            if(db.nrg >= 1) { db.nrg--; db.bal += db.vip ? 1.5 : 0.5; update(); }
        };

        setInterval(update, 1000);
        update();
    </script>
</body>
</html>
