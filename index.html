<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TON Empire Stable PvP</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ –∂–µ —Å—Ç–∏–ª–∏, —á—Ç–æ –±—ã–ª–∏ —Ä–∞–Ω—å—à–µ */
        :root { --accent: #0098EA; --bg: #0b0f1a; --glass: rgba(255, 255, 255, 0.07); }
        body { background: var(--bg); color: #fff; text-align: center; font-family: 'Inter', sans-serif; margin: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        .top-bar { background: rgba(11, 15, 26, 0.8); backdrop-filter: blur(20px); padding: 15px 20px; display: flex; justify-content: space-between; border-bottom: 1px solid var(--glass); }
        .online-tag { font-size: 10px; background: rgba(16, 185, 129, 0.2); color: #10b981; padding: 2px 8px; border-radius: 10px; display: inline-block; margin-bottom: 5px; }
        .balance-val { font-size: 22px; font-weight: 900; color: #fff; text-shadow: 0 0 15px var(--accent); }
        .tab-content { flex-grow: 1; display: none; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; padding-bottom: 120px; }
        .active-tab { display: flex; }
        .wheel-container { position: relative; width: 100%; height: 80px; background: #161b2a; border-radius: 15px; overflow: hidden; margin: 20px 0; border: 2px solid var(--glass); }
        .wheel-line { display: flex; position: absolute; left: 0; transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1); will-change: transform; }
        .wheel-item { min-width: 60px; height: 60px; margin: 10px; background: var(--accent); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; }
        .wheel-pointer { position: absolute; top: 0; left: 50%; width: 4px; height: 100%; background: #ff4757; transform: translateX(-50%); z-index: 10; box-shadow: 0 0 10px #ff4757; }
        #coin { width: 190px; height: 190px; background: linear-gradient(135deg, #0098EA, #00f2ff); border-radius: 50%; margin: 20px auto; display: flex; align-items: center; justify-content: center; font-size: 60px; cursor: pointer; box-shadow: 0 0 40px rgba(0, 152, 234, 0.4); position: relative; }
        .glass-card { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 15px; width: 100%; margin-bottom: 12px; box-sizing: border-box; }
        .btn { border: none; padding: 15px; border-radius: 15px; font-weight: 800; color: #fff; cursor: pointer; width: 100%; }
        .btn-blue { background: var(--accent); }
        .input-dark { background: #161b2a; border: 1px solid #2d3748; color: #fff; padding: 12px; border-radius: 12px; width: 90%; margin-bottom: 10px; text-align: center; }
        .bottom-nav { background: rgba(11, 15, 26, 0.95); display: flex; justify-content: space-around; padding: 12px 0 35px 0; position: fixed; bottom: 0; width: 100%; border-top: 1px solid var(--glass); }
        .nav-item { color: #64748b; font-size: 11px; cursor: pointer; }
        .nav-item.active { color: var(--accent); }
    </style>
</head>
<body>
    <div class="top-bar">
        <div style="text-align: left;">
            <div class="online-tag">‚óè ONLINE: <span id="online-cnt">...</span></div>
            <div class="balance-val"><span id="balance">0.00</span> <small style="font-size:10px">TON</small></div>
        </div>
        <div style="text-align: right;"><small style="color:#94a3b8">PPS</small><div style="color:#34d399; font-weight:bold;">+<span id="pps">0</span></div></div>
    </div>

    <div id="tab-farm" class="tab-content active-tab">
        <div id="coin">üíé</div>
        <div style="font-size: 28px; font-weight: 900;">‚ö° <span id="energy">250</span></div>
    </div>

    <div id="tab-games" class="tab-content">
        <div id="g-list" style="width:100%">
            <div class="glass-card" onclick="uiG('mines')">üí£ –ú–ò–ù–´</div>
            <div class="glass-card" onclick="uiG('ladder')">ü™ú –õ–ï–°–ï–ù–ö–ê</div>
            <div class="glass-card" onclick="uiG('wheel')" style="border-color:#f59e0b">üé° PvP –î–ñ–ï–ö–ü–û–¢</div>
        </div>
        <div id="g-play" style="display:none; width:100%">
            <h2 id="g-title">–ò–ì–†–ê</h2>
            <div id="g-area"></div>
            <div id="g-info" style="margin:10px; color:#f59e0b; font-weight:bold;"></div>
            <button id="btn-cashout" class="btn btn-blue" style="display:none; background:#f59e0b; margin-bottom:10px;" onclick="doCashout()">–ó–ê–ë–†–ê–¢–¨</button>
            <button class="btn" style="background:#334155" onclick="closeG()">–ù–ê–ó–ê–î</button>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchT('farm', this)"><b>‚õè</b><br>–ö–ª–∏–∫</div>
        <div class="nav-item" onclick="switchT('games', this)"><b>üé≤</b><br>–ò–≥—Ä—ã</div>
    </div>

    <script>
        function n(v, f=0) { let res = parseFloat(v); return isNaN(res) ? f : res; }

        // –î–æ–±–∞–≤–∏–ª–∏ jackpot_bet –∏ jackpot_pot –≤ –æ—Å–Ω–æ–≤–Ω—É—é –±–∞–∑—É
        let db = JSON.parse(localStorage.getItem('ton_empire_secure')) || { 
            bal: 100, nrg: 250, pps: 0, last: Date.now(), 
            jackpot_bet: 0, jackpot_pot: 0 
        };

        let wheelRunning = false;
        let timerId = null;

        function save() { localStorage.setItem('ton_empire_secure', JSON.stringify(db)); }

        function update() {
            let now = Date.now();
            let dt = (now - db.last) / 1000;
            db.bal = n(db.bal + (n(db.pps) * dt));
            db.nrg = Math.min(250, db.nrg + (dt * 0.2));
            db.last = now;

            document.getElementById('balance').innerText = n(db.bal).toFixed(2);
            document.getElementById('pps').innerText = n(db.pps).toFixed(2);
            document.getElementById('energy').innerText = Math.floor(n(db.nrg));
            document.getElementById('online-cnt').innerText = Math.floor(Math.random() * 50) + 800;
            save();
        }

        function uiG(t) {
            document.getElementById('g-list').style.display = 'none';
            document.getElementById('g-play').style.display = 'block';
            let area = document.getElementById('g-area');
            
            if(t === 'wheel') {
                document.getElementById('g-title').innerText = "PvP –î–ñ–ï–ö–ü–û–¢";
                area.innerHTML = `
                    <div class="wheel-container">
                        <div class="wheel-pointer"></div>
                        <div id="w-line" class="wheel-line"></div>
                    </div>
                    <div id="w-status" style="font-size:14px; color:#34d399">–ñ–¥–µ–º —Å—Ç–∞–≤–æ–∫...</div>
                    <div id="w-pot-val" style="font-size:24px; margin:10px 0;">–ë–∞–Ω–∫: 0.00 TON</div>
                    <div id="w-inputs">
                        <input type="number" id="wb" class="input-dark" placeholder="–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞">
                        <button class="btn btn-blue" onclick="betWheel()">–ü–û–°–¢–ê–í–ò–¢–¨</button>
                    </div>
                `;
                renderWheelItems();
                // –ï—Å–ª–∏ –ø—Ä–∏ –∑–∞—Ö–æ–¥–µ —É–∂–µ –µ—Å—Ç—å —Å—Ç–∞–≤–∫–∞ ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥
                if(db.jackpot_bet > 0) {
                    restoreJackpot();
                }
            } else if(t === 'mines') {
                area.innerHTML = `<input type="number" id="mb" class="input-dark" placeholder="–°—Ç–∞–≤–∫–∞"><button class="btn btn-blue" onclick="startM()">–ò–ì–†–ê–¢–¨</button><div id="m-grid" class="mines-grid"></div>`;
            }
        }

        function renderWheelItems() {
            const line = document.getElementById('w-line');
            if(!line) return;
            line.innerHTML = '';
            const icons = ['üíé', 'üí∞', 'üî•', 'üëë', '‚≠ê', 'üçÄ'];
            for(let i=0; i<45; i++) {
                let div = document.createElement('div');
                div.className = 'wheel-item';
                div.innerText = icons[i % icons.length];
                line.appendChild(div);
            }
        }

        function betWheel() {
            let b = n(document.getElementById('wb').value);
            if(b < 1 || b > db.bal) return alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞!");
            
            db.bal -= b;
            db.jackpot_bet = b;
            db.jackpot_pot = b;
            save();
            
            restoreJackpot();
            
            // –°–∏–º—É–ª—è—Ü–∏—è –≤—Ö–æ–¥–∞ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞
            setTimeout(() => {
                db.jackpot_pot += b * 1.5;
                save();
                if(document.getElementById('w-pot-val')) {
                    document.getElementById('w-pot-val').innerText = `–ë–∞–Ω–∫: ${db.jackpot_pot.toFixed(2)} TON`;
                    startCountDown();
                }
            }, 4000);
        }

        function restoreJackpot() {
            let potEl = document.getElementById('w-pot-val');
            let statusEl = document.getElementById('w-status');
            let inputEl = document.getElementById('w-inputs');
            if(potEl) potEl.innerText = `–ë–∞–Ω–∫: ${db.jackpot_pot.toFixed(2)} TON`;
            if(statusEl) statusEl.innerText = "–°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞! –ñ–¥–µ–º –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞...";
            if(inputEl) inputEl.style.display = 'none'; // –ü—Ä—è—á–µ–º –≤–≤–æ–¥ –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã
        }

        function startCountDown() {
            let s = 10;
            if(timerId) clearInterval(timerId);
            timerId = setInterval(() => {
                let statusEl = document.getElementById('w-status');
                if(!statusEl) { clearInterval(timerId); return; }
                statusEl.innerText = `–ò–≥—Ä–∞ –Ω–∞—á–Ω–µ—Ç—Å—è —á–µ—Ä–µ–∑ ${s}—Å`;
                s--;
                if(s < 0) {
                    clearInterval(timerId);
                    runWheel();
                }
            }, 1000);
        }

        function runWheel() {
            if(wheelRunning) return;
            wheelRunning = true;
            const line = document.getElementById('w-line');
            if(!line) return;
            
            const shift = Math.floor(Math.random() * 1000) + 1500;
            line.style.transform = `translateX(-${shift}px)`;
            
            setTimeout(() => {
                alert("üéâ –í–´–ò–ì–†–´–®: " + db.jackpot_pot.toFixed(2) + " TON!");
                db.bal += db.jackpot_pot;
                db.jackpot_bet = 0;
                db.jackpot_pot = 0;
                wheelRunning = false;
                save();
                
                // –°–±—Ä–æ—Å –≤–∏–∑—É–∞–ª–∞
                closeG(); 
                update();
            }, 4500);
        }

        function closeG() { 
            document.getElementById('g-list').style.display = 'block'; 
            document.getElementById('g-play').style.display = 'none'; 
            if(timerId) clearInterval(timerId);
        }

        function switchT(id, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('tab-' + id).classList.add('active-tab');
            el.classList.add('active');
        }

        document.getElementById('coin').onclick = () => {
            if(db.nrg >= 1) { db.nrg--; db.bal += 0.5; update(); }
        };

        setInterval(update, 1000);
        update();
    </script>
</body>
</html>
