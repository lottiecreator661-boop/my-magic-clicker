<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TON Empire Ultimate</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --accent: #0098EA; --glass: rgba(255, 255, 255, 0.1); --bg: #0f172a; }
        body {
            background: radial-gradient(circle at top, #1e1b4b, var(--bg));
            color: #fff; text-align: center; font-family: 'Segoe UI', sans-serif;
            margin: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh;
        }

        .top-bar { background: rgba(0,0,0,0.4); backdrop-filter: blur(15px); padding: 15px 20px; display: flex; justify-content: space-between; border-bottom: 1px solid var(--glass); z-index: 100; }
        .balance-val { font-size: 22px; font-weight: bold; color: var(--accent); }

        .tab-content { flex-grow: 1; display: none; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; width: 100%; box-sizing: border-box; padding-bottom: 100px; }
        .active-tab { display: flex; }

        /* –ö–õ–ò–ö–ï–† –ò –ê–ù–ò–ú–ê–¶–ò–Ø */
        #coin { width: 180px; height: 180px; background: var(--accent); border-radius: 50%; margin: 30px auto; display: flex; align-items: center; justify-content: center; font-size: 50px; cursor: pointer; position: relative; box-shadow: 0 0 30px var(--accent); transition: 0.05s; }
        #coin:active { transform: scale(0.92); }
        .tap-anim { position: absolute; color: #fff; font-weight: bold; font-size: 24px; pointer-events: none; animation: fly 0.8s forwards; }
        @keyframes fly { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }

        /* –ì–†–ò–î–´ –ò–ì–† (–ù–ï –¢–†–û–ù–£–¢–û) */
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin: 15px 0; }
        .m-cell { width: 50px; height: 50px; background: #334155; border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .open-gem { background: #10b981; } .open-bomb { background: #ef4444; }
        .ladder-grid { display: flex; flex-direction: column-reverse; gap: 8px; width: 240px; }
        .ladder-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .ladder-row.locked { opacity: 0.3; pointer-events: none; }
        .l-cell { background: #334155; padding: 15px; border-radius: 10px; font-weight: bold; }

        /* –ò–ù–¢–ï–†–§–ï–ô–° –ö–ê–†–¢–û–ß–ï–ö */
        .glass-card { background: var(--glass); border: 1px solid var(--glass); border-radius: 20px; padding: 15px; width: 100%; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; box-sizing: border-box; }
        .input-dark { background: #0f172a; border: 1px solid #334155; color: #fff; padding: 12px; border-radius: 12px; width: 90%; margin-bottom: 10px; text-align: center; }
        .btn { border: none; padding: 14px; border-radius: 14px; font-weight: bold; color: #fff; cursor: pointer; width: 100%; }
        .btn-blue { background: var(--accent); } .btn-orange { background: #f59e0b; } .btn-green { background: #10b981; }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .bottom-nav { background: #0f172a; border-top: 1px solid var(--glass); display: flex; justify-content: space-around; padding: 10px 0 30px 0; position: fixed; bottom: 0; width: 100%; }
        .nav-item { color: #94a3b8; font-size: 10px; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--accent); }
        .nav-item b { font-size: 20px; display: block; }
    </style>
</head>
<body>

    <div class="top-bar">
        <div><small>–ë–ê–õ–ê–ù–°</small><div class="balance-val">üíé <span id="balance">0</span></div></div>
        <div style="text-align: right;"><small>–î–û–•–û–î/–°–ï–ö</small><div style="color:#34d399; font-weight:bold;">+<span id="pps">0</span></div></div>
    </div>

    <div id="tab-farm" class="tab-content active-tab">
        <div id="coin">üíé</div>
        <div style="font-size: 24px; font-weight: bold;">‚ö° <span id="energy">250</span></div>
        <div style="width: 80%; background: var(--glass); height: 8px; border-radius: 4px; margin-top:15px; overflow:hidden;">
            <div id="nrg-bar" style="height:100%; background:var(--accent); width:100%;"></div>
        </div>
    </div>

    <div id="tab-mine" class="tab-content">
        <h3>‚õè –ú–∞–π–Ω–∏–Ω–≥ –§–µ—Ä–º—ã</h3>
        <div class="glass-card">
            <div><b>GPU Card V1</b><br><small>+0.05 TON/—Å–µ–∫</small></div>
            <button class="btn btn-blue" style="width:100px" onclick="buyM(1, 50, 0.05)">50 TON</button>
        </div>
        <div class="glass-card">
            <div><b>Server Farm</b><br><small>+0.25 TON/—Å–µ–∫</small></div>
            <button class="btn btn-blue" style="width:100px" onclick="buyM(2, 250, 0.25)">250 TON</button>
        </div>
        <div class="glass-card">
            <div><b>Quantum PC</b><br><small>+1.50 TON/—Å–µ–∫</small></div>
            <button class="btn btn-blue" style="width:100px" onclick="buyM(3, 1000, 1.5)">1000 TON</button>
        </div>
    </div>

    <div id="tab-games" class="tab-content">
        <div id="g-list" style="width:100%">
            <div class="glass-card" onclick="uiG('mines')"><b>üí£ –ú–ò–ù–´</b><span>‚ñ∂</span></div>
            <div class="glass-card" onclick="uiG('ladder')"><b>ü™ú –õ–ï–°–ï–ù–ö–ê</b><span>‚ñ∂</span></div>
            <div class="glass-card" onclick="uiG('wheel')"><b>üé° –†–£–õ–ï–¢–ö–ê (PvP)</b><span>‚ñ∂</span></div>
        </div>
        <div id="g-play" style="display:none; width:100%">
            <h2 id="g-title">–ò–≥—Ä–∞</h2>
            <div id="g-area"></div>
            <div id="g-info" style="margin:15px 0; color:#f59e0b; font-weight:bold;"></div>
            <button id="btn-cashout" class="btn btn-orange" style="display:none" onclick="doCashout()">–ó–ê–ë–†–ê–¢–¨</button>
            <button class="btn btn-red" style="margin-top:10px" onclick="closeG()">–í–´–ô–¢–ò</button>
        </div>
    </div>

    <div id="tab-profile" class="tab-content">
        <div class="glass-card" style="flex-direction:column; gap:10px;">
            <h2 id="p-name">–ò–≥—Ä–æ–∫</h2>
            <button class="btn btn-green" onclick="claimDaily()">üéÅ –ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–°</button>
            <div style="display:flex; justify-content:space-around; width:100%; margin-top:10px;">
                <div><b id="st-c">0</b><br><small>–ö–ª–∏–∫–æ–≤</small></div>
                <div><b id="st-g">0</b><br><small>–ò–≥—Ä</small></div>
            </div>
        </div>
        <div class="glass-card" style="flex-direction:column; align-items:flex-start;">
            <b>üîó –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–°–´–õ–ö–ê</b>
            <small id="ref-link" style="color:var(--accent); word-break:break-all;"></small>
            <button class="btn btn-blue" style="margin-top:10px" onclick="copyRef()">–ö–û–ü–ò–†–û–í–ê–¢–¨</button>
        </div>
        <div class="glass-card" style="flex-direction:column; align-items:flex-start;">
            <b>üìù –ö–í–ï–°–¢–´</b>
            <div id="quests-list" style="font-size:12px; width:100%; margin-top:5px;"></div>
        </div>
    </div>

    <div id="tab-admin" class="tab-content">
        <h3>–ê–¥–º–∏–Ω–∫–∞</h3>
        <input type="text" id="adm-id" class="input-dark" placeholder="ID –∏–≥—Ä–æ–∫–∞">
        <input type="number" id="adm-v" class="input-dark" placeholder="–°—É–º–º–∞">
        <button class="btn btn-blue" onclick="adm(1)">–î–∞—Ç—å TON</button>
        <button class="btn btn-orange" style="margin-top:10px" onclick="adm(2)">–í—ã–¥–∞—Ç—å VIP</button>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchT('farm', this)"><b>‚õè</b>–§–∞—Ä–º</div>
        <div class="nav-item" onclick="switchT('mine', this)"><b>üíª</b>–ú–∞–π–Ω–∏–Ω–≥</div>
        <div class="nav-item" onclick="switchT('games', this)"><b>üé≤</b>–ò–≥—Ä—ã</div>
        <div class="nav-item" onclick="switchT('profile', this)"><b>üë§</b>–ü—Ä–æ—Ñ–∏–ª—å</div>
        <div id="adm-nav" class="nav-item" style="display:none" onclick="switchT('admin', this)"><b>‚öôÔ∏è</b></div>
    </div>

    <script>
        const ADMINS = [7177436669, 8388334620];
        let tg = window.Telegram.WebApp;
        let userId = tg.initDataUnsafe?.user?.id || 123;
        
        let db = JSON.parse(localStorage.getItem('ton_mega_v1')) || {
            bal: 10, clk: 0, nrg: 250, pps: 0, last: Date.now(), 
            vip: false, games: 0, daily: 0, q1: false
        };

        let cur = { active: false, bet: 0, mult: 1, type: '', data: null, step: 0 };
        let wheelTimer = 30;

        function save() { localStorage.setItem('ton_mega_v1', JSON.stringify(db)); }

        function update() {
            let now = Date.now();
            let dt = (now - db.last) / 1000;
            db.bal += db.pps * dt;
            let maxN = db.vip ? 10000 : 250;
            db.nrg = Math.min(maxN, db.nrg + (dt * (db.vip ? 0.8 : 0.2)));
            db.last = now;

            document.getElementById('balance').innerText = db.bal.toFixed(2);
            document.getElementById('pps').innerText = db.pps.toFixed(2);
            document.getElementById('energy').innerText = Math.floor(db.nrg);
            document.getElementById('nrg-bar').style.width = (db.nrg/maxN*100)+'%';
            document.getElementById('st-c').innerText = db.clk;
            document.getElementById('st-g').innerText = db.games;
            document.getElementById('ref-link').innerText = `t.me/your_bot?start=${userId}`;
            
            // –ö–≤–µ—Å—Ç—ã
            let q = document.getElementById('quests-list');
            q.innerHTML = `–ö–ª–∏–∫–∏ (1000): ${db.clk >= 1000 ? '‚úÖ' : '‚ùå'}`;
            if(db.clk >= 1000 && !db.q1) { db.bal += 50; db.q1 = true; alert("–ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω! +50 TON"); }

            if(ADMINS.includes(userId)) document.getElementById('adm-nav').style.display = 'block';
            save();
        }

        // –ö–õ–ò–ö–ï–†
        document.getElementById('coin').onclick = (e) => {
            if(db.nrg >= 1) {
                db.nrg--; db.clk++;
                let add = db.vip ? 1.5 : 0.5;
                db.bal += add;
                // –ê–Ω–∏–º–∞—Ü–∏—è
                let a = document.createElement('div');
                a.className = 'tap-anim'; a.innerText = `+${add}`;
                a.style.left = e.clientX + 'px'; a.style.top = e.clientY + 'px';
                document.body.appendChild(a);
                setTimeout(() => a.remove(), 800);
                update();
            }
        };

        // –ò–ì–†–´
        function uiG(t) {
            document.getElementById('g-list').style.display = 'none';
            document.getElementById('g-play').style.display = 'block';
            cur.type = t;
            let area = document.getElementById('g-area');
            if(t === 'mines') {
                document.getElementById('g-title').innerText = "–ú–ò–ù–´";
                area.innerHTML = `<input type="number" id="mb" class="input-dark" placeholder="–°—Ç–∞–≤–∫–∞"><select id="mc" class="input-dark"><option value="3">3 –ú–∏–Ω</option><option value="5">5 –ú–∏–Ω</option><option value="10">10 –ú–∏–Ω</option></select><button class="btn btn-blue" onclick="startM()">–ò–ì–†–ê–¢–¨</button><div id="m-grid" class="mines-grid"></div>`;
            } else if(t === 'ladder') {
                document.getElementById('g-title').innerText = "–õ–ï–°–ï–ù–ö–ê";
                area.innerHTML = `<input type="number" id="lb" class="input-dark" placeholder="–°—Ç–∞–≤–∫–∞"><button class="btn btn-blue" onclick="startL()">–ù–ê–ß–ê–¢–¨</button><div id="l-grid" class="ladder-grid"></div>`;
            } else if(t === 'wheel') {
                document.getElementById('g-title').innerText = "–†–£–õ–ï–¢–ö–ê (PvP)";
                area.innerHTML = `<div id="wheel-timer" style="font-size:20px; color:var(--accent)">–î–æ –Ω–∞—á–∞–ª–∞: 30—Å</div><div id="pot" style="margin:10px">–ë–∞–Ω–∫: 0 TON</div><input type="number" id="wb" class="input-dark" placeholder="–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞"><button class="btn btn-blue" onclick="betWheel()">–ü–û–°–¢–ê–í–ò–¢–¨</button>`;
                startWheelLogic();
            }
        }

        function startWheelLogic() {
            let timerEl = document.getElementById('wheel-timer');
            let potEl = document.getElementById('pot');
            let pot = 0;
            let int = setInterval(() => {
                if(cur.type !== 'wheel') { clearInterval(int); return; }
                wheelTimer--;
                timerEl.innerText = `–î–æ –Ω–∞—á–∞–ª–∞: ${wheelTimer}—Å`;
                if(wheelTimer <= 0) {
                    wheelTimer = 30;
                    if(pot > 0) {
                        alert("–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ " + pot + " TON!");
                        db.bal += pot; pot = 0; potEl.innerText = "–ë–∞–Ω–∫: 0 TON";
                        update();
                    }
                }
            }, 1000);
        }
        function betWheel() {
            let b = parseFloat(document.getElementById('wb').value);
            if(b > db.bal || b <= 0) return;
            db.bal -= b; document.getElementById('pot').innerText = `–ë–∞–Ω–∫: ${b + 10} TON (–ñ–¥–µ–º –∏–≥—Ä–æ–∫–æ–≤...)`;
            update();
        }

        // –ú–ò–ù–´ –ò –õ–ï–°–ï–ù–ö–ê (–¢–í–û–ò –†–û–î–ù–´–ï)
        function startM() {
            let b = parseFloat(document.getElementById('mb').value); let c = parseInt(document.getElementById('mc').value);
            if(b > db.bal || b <= 0) return; db.bal -= b; db.games++;
            cur = { active: true, bet: b, mult: 1, type: 'mines', data: Array(25).fill(false) };
            let p=0; while(p<c){let r=Math.floor(Math.random()*25); if(!cur.data[r]){cur.data[r]=true; p++;}}
            let grid = document.getElementById('m-grid'); grid.innerHTML = '';
            for(let i=0; i<25; i++) {
                let d = document.createElement('div'); d.className = 'm-cell'; d.innerText = '?';
                d.onclick = () => {
                    if(!cur.active || d.innerText !== '?') return;
                    if(cur.data[i]) { d.innerText = 'üí£'; d.classList.add('open-bomb'); cur.active = false; document.getElementById('btn-cashout').style.display = 'none'; }
                    else { d.innerText = 'üíé'; d.classList.add('open-gem'); cur.mult += (c/4)+0.2; document.getElementById('g-info').innerText = `–ó–∞–±–µ—Ä–µ—à—å: ${(cur.bet*cur.mult).toFixed(2)} | –°–ª–µ–¥: x${(cur.mult+(c/4)+0.2).toFixed(2)}`; document.getElementById('btn-cashout').style.display = 'block'; }
                }; grid.appendChild(d);
            }
            update();
        }

        function startL() {
            let b = parseFloat(document.getElementById('lb').value); if(b > db.bal || b <= 0) return;
            db.bal -= b; db.games++; cur = { active: true, bet: b, mult: 1, type: 'ladder', step: 0 };
            let grid = document.getElementById('l-grid'); grid.innerHTML = '';
            for(let i=0; i<6; i++) {
                let r = document.createElement('div'); r.className = 'ladder-row' + (i>0?' locked':'');
                let t = Math.floor(Math.random()*2);
                r.innerHTML = `<div class="l-cell" onclick="stepL(0,${t},${i},this)">?</div><div class="l-cell" onclick="stepL(1,${t},${i},this)">?</div>`;
                grid.appendChild(r);
            }
            update();
        }
        function stepL(ch, tr, idx, el) {
            if(!cur.active || idx !== cur.step) return;
            if(ch === tr) { el.innerText = 'üí•'; el.style.background = '#ef4444'; cur.active = false; document.getElementById('btn-cashout').style.display = 'none'; }
            else { el.innerText = 'üíé'; el.style.background = '#10b981'; cur.mult *= 2; cur.step++; document.getElementById('btn-cashout').style.display = 'block'; if(cur.step < 6) document.querySelectorAll('.ladder-row')[cur.step].classList.remove('locked'); }
        }

        function doCashout() { if(!cur.active) return; db.bal += cur.bet * cur.mult; cur.active = false; closeG(); update(); }
        function closeG() { document.getElementById('g-list').style.display = 'block'; document.getElementById('g-play').style.display = 'none'; document.getElementById('g-info').innerText = ''; cur.active = false; }

        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï
        function buyM(id, cost, p) { if(db.bal >= cost){ db.bal -= cost; db.pps += p; update(); alert("–ö—É–ø–ª–µ–Ω–æ!"); } }
        function claimDaily() { if(Date.now() - db.daily > 86400000){ db.bal += 10; db.daily = Date.now(); alert("–ë–æ–Ω—É—Å 10 TON –ø–æ–ª—É—á–µ–Ω!"); } else alert("–£–∂–µ –∑–∞–±–∏—Ä–∞–ª!"); }
        function copyRef() { navigator.clipboard.writeText(document.getElementById('ref-link').innerText); alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!"); }
        function switchT(id, el) { document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab')); document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); document.getElementById('tab-' + id).classList.add('active-tab'); el.classList.add('active'); closeG(); }
        function adm(m) { let v = parseFloat(document.getElementById('adm-v').value); if(m===1) db.bal += v; else db.vip = true; update(); }

        setInterval(update, 1000);
        update();
    </script>
</body>
</html>
