<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TON EMPIRE</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #0b0f1a; color: white; font-family: sans-serif; text-align: center; margin: 0; padding: 0; overflow: hidden; }
        .header { padding: 20px; background: rgba(0,0,0,0.3); border-bottom: 1px solid #0098EA; display: flex; justify-content: space-between; align-items: center; }
        .balance { font-size: 24px; font-weight: bold; color: #0098EA; }
        .online { color: #10b981; font-size: 12px; }
        
        #coin { width: 200px; height: 200px; background: #0098EA; border-radius: 50%; margin: 50px auto; display: flex; align-items: center; justify-content: center; font-size: 60px; cursor: pointer; box-shadow: 0 0 20px #0098EA; }
        
        .menu { position: fixed; bottom: 0; width: 100%; display: flex; background: #161b2a; padding: 10px 0; border-top: 1px solid #0098EA; }
        .menu-item { flex: 1; cursor: pointer; font-size: 14px; }
        
        .tab { display: none; padding: 20px; height: 80vh; overflow-y: auto; }
        .active { display: block; }
        
        .card { background: #1e293b; padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #334155; }
        .btn { background: #0098EA; border: none; color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold; }
        .input { background: #0b0f1a; border: 1px solid #0098EA; color: white; padding: 10px; border-radius: 5px; width: 80%; margin-bottom: 10px; text-align: center; }

        /* PvP –†—É–ª–µ—Ç–∫–∞ –í–∏–∑—É–∞–ª */
        .wheel-box { width: 100%; height: 60px; background: #0b0f1a; border: 1px solid #0098EA; margin: 10px 0; overflow: hidden; position: relative; border-radius: 5px; }
        .wheel-track { display: flex; position: absolute; transition: transform 4s cubic-bezier(0.1, 0, 0.1, 1); }
        .wheel-item { min-width: 50px; height: 50px; border: 1px solid #334155; display: flex; align-items: center; justify-content: center; margin: 5px; }

        /* –ú–∏–Ω—ã –ì—Ä–∏–¥ */
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-top: 10px; }
        .m-cell { background: #334155; height: 50px; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
    </style>
</head>
<body>

<div class="header">
    <div style="text-align: left;">
        <div class="online">‚óè ONLINE: <span id="onl">742</span></div>
        <div class="balance"><span id="bal">0.00</span> TON</div>
    </div>
    <div style="text-align: right; font-size: 12px;">–≠–ù–ï–†–ì–ò–Ø: <span id="nrg">250</span></div>
</div>

<div id="farm" class="tab active">
    <div id="coin">üíé</div>
    <div id="nrg-timer" style="font-size: 12px; color: #64748b;"></div>
</div>

<div id="games" class="tab">
    <div id="g-main">
        <div class="card" onclick="openGame('mines')">üí£ –ú–ò–ù–´</div>
        <div class="card" onclick="openGame('wheel')">üé° PvP –†–£–õ–ï–¢–ö–ê</div>
    </div>

    <div id="g-play" style="display:none;">
        <h3 id="g-title">–ò–ì–†–ê</h3>
        <div id="g-box"></div>
        <div id="g-status" style="color:#f59e0b; margin:10px;"></div>
        <button id="cash-btn" class="btn" style="display:none; background:#10b981; margin-bottom:10px;" onclick="cashout()">–ó–ê–ë–†–ê–¢–¨</button>
        <button class="btn" style="background:#475569" onclick="back()">–ù–ê–ó–ê–î</button>
    </div>
</div>

<div class="menu">
    <div class="menu-item" onclick="tab('farm')">üíé –§–ê–†–ú</div>
    <div class="menu-item" onclick="tab('games')">üé≤ –ò–ì–†–´</div>
</div>

<script>
    // –©–ò–¢ –û–¢ NaN
    function safe(v, f=0) { let r = parseFloat(v); return isNaN(r) ? f : r; }

    let db = JSON.parse(localStorage.getItem('ton_original_save')) || {
        bal: 50, nrg: 250, last: Date.now(), jackpot_bet: 0
    };

    function save() { localStorage.setItem('ton_original_save', JSON.stringify(db)); }

    function sync() {
        let now = Date.now();
        let dt = (now - db.last) / 1000;
        if(db.nrg < 250) db.nrg = Math.min(250, db.nrg + (dt * 0.2));
        db.last = now;
        
        document.getElementById('bal').innerText = safe(db.bal).toFixed(2);
        document.getElementById('nrg').innerText = Math.floor(safe(db.nrg));
        document.getElementById('onl').innerText = Math.floor(Math.random()*50) + 700;
        save();
    }

    // –¢–ê–ü
    document.getElementById('coin').onclick = () => {
        if(db.nrg >= 1) { db.nrg--; db.bal += 0.5; sync(); }
    };

    function tab(id) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // –ò–ì–†–´
    let cur = { active: false, bet: 0, mult: 1, data: [] };

    function openGame(g) {
        document.getElementById('g-main').style.display = 'none';
        document.getElementById('g-play').style.display = 'block';
        let box = document.getElementById('g-box');
        
        if(g === 'mines') {
            document.getElementById('g-title').innerText = "–ú–ò–ù–´";
            box.innerHTML = `
                <input id="bet" class="input" type="number" placeholder="–°—Ç–∞–≤–∫–∞">
                <button class="btn" onclick="startMines()">–ò–ì–†–ê–¢–¨</button>
                <div id="m-grid" class="mines-grid"></div>
            `;
        } else if(g === 'wheel') {
            document.getElementById('g-title').innerText = "PvP –†–£–õ–ï–¢–ö–ê";
            box.innerHTML = `
                <div class="wheel-box"><div id="w-track" class="wheel-track"></div></div>
                <div id="w-info">–ë–∞–Ω–∫: 0.00 TON</div>
                <div id="w-ui">
                    <input id="w-bet" class="input" type="number" placeholder="–°—Ç–∞–≤–∫–∞">
                    <button class="btn" onclick="startWheel()">–ü–û–°–¢–ê–í–ò–¢–¨</button>
                </div>
            `;
            let tr = document.getElementById('w-track');
            for(let i=0; i<40; i++) tr.innerHTML += `<div class="wheel-item">${i%2?'üíé':'üí∞'}</div>`;
            if(db.jackpot_bet > 0) restoreWheel();
        }
    }

    // PvP –õ–û–ì–ò–ö–ê (–ù–ï –°–ì–û–†–ê–ï–¢)
    function startWheel() {
        let b = safe(document.getElementById('w-bet').value);
        if(b < 1 || b > db.bal) return alert("–û—à–∏–±–∫–∞ —Å—Ç–∞–≤–∫–∏");
        db.bal -= b; db.jackpot_bet = b; save();
        restoreWheel();
        setTimeout(() => { if(db.jackpot_bet > 0) runWheel(); }, 5000);
    }

    function restoreWheel() {
        document.getElementById('w-info').innerText = "–ë–∞–Ω–∫: " + (db.jackpot_bet * 2).toFixed(2) + " TON";
        document.getElementById('g-status').innerText = "–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞...";
        document.getElementById('w-ui').style.display = 'none';
    }

    function runWheel() {
        let tr = document.getElementById('w-track');
        if(!tr) return;
        tr.style.transform = `translateX(-${Math.floor(Math.random()*1000)+1000}px)`;
        setTimeout(() => {
            let win = db.jackpot_bet * 2;
            alert("–í–´–ò–ì–†–´–®: " + win.toFixed(2));
            db.bal += win; db.jackpot_bet = 0; save();
            back(); sync();
        }, 4500);
    }

    // –ú–ò–ù–´ (–û–†–ò–ì–ò–ù–ê–õ)
    function startMines() {
        let b = safe(document.getElementById('bet').value);
        if(b < 1 || b > db.bal) return alert("–ú–∞–ª–æ TON");
        db.bal -= b; cur = { active: true, bet: b, mult: 1, data: Array(25).fill(false) };
        for(let i=0; i<3; i++) cur.data[Math.floor(Math.random()*25)] = true;
        
        let grid = document.getElementById('m-grid'); grid.innerHTML = '';
        for(let i=0; i<25; i++) {
            let c = document.createElement('div'); c.className = 'm-cell'; c.innerText = '?';
            c.onclick = () => {
                if(!cur.active || c.innerText !== '?') return;
                if(cur.data[i]) { c.innerText = 'üí£'; c.style.background = 'red'; cur.active = false; document.getElementById('cash-btn').style.display='none'; }
                else { c.innerText = 'üíé'; c.style.background = 'green'; cur.mult += 0.5; document.getElementById('g-status').innerText = "–ö–£–®: "+(cur.bet*cur.mult).toFixed(2); document.getElementById('cash-btn').style.display='block'; }
            };
            grid.appendChild(c);
        }
        sync();
    }

    function cashout() { if(!cur.active) return; db.bal += cur.bet * cur.mult; cur.active = false; back(); sync(); }
    function back() { document.getElementById('g-main').style.display = 'block'; document.getElementById('g-play').style.display = 'none'; document.getElementById('g-status').innerText = ''; }

    setInterval(sync, 1000);
    sync();
</script>

</body>
</html>
