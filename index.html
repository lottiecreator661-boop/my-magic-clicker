<script>
Â  Â  let tg = window.Telegram.WebApp;
Â  Â  let userId = tg.initDataUnsafe?.user?.id || 0;
Â  Â Â 
Â  Â  // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ½Ğ° Ñ‡Ğ¸ÑĞ»Ğ¾
Â  Â  function n(val, fallback = 0) {
Â  Â  Â  Â  let num = parseFloat(val);
Â  Â  Â  Â  return isNaN(num) || !isFinite(num) ? fallback : num;
Â  Â  }

Â  Â  let today = new Date().toLocaleDateString();
Â  Â  let saved = JSON.parse(localStorage.getItem('ton_final_elite')) || {};
Â  Â Â 
Â  Â  // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ¾Ğ¹ Ğ¾Ñ‚ Ğ¿ÑƒÑÑ‚Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
Â  Â  let db = {
Â  Â  Â  Â  bal: n(saved.bal, 50),
Â  Â  Â  Â  nrg: n(saved.nrg, 250),
Â  Â  Â  Â  pps: n(saved.pps, 0),
Â  Â  Â  Â  clk: n(saved.clk, 0),
Â  Â  Â  Â  last: n(saved.last, Date.now()),
Â  Â  Â  Â  vip: saved.vip || false,
Â  Â  Â  Â  daily: n(saved.daily, 0),
Â  Â  Â  Â  q_date: saved.q_date || today,
Â  Â  Â  Â  q_list: saved.q_list || [false, false, false, false, false]
Â  Â  };

Â  Â  if(db.q_date !== today) {
Â  Â  Â  Â  db.q_list = [false, false, false, false, false];
Â  Â  Â  Â  db.q_date = today;
Â  Â  }

Â  Â  let cur = { active: false, bet: 0, mult: 1, type: '', data: null, step: 0 };
Â  Â  let wheelSec = 30;

Â  Â  function save() {Â 
Â  Â  Â  Â  // ĞŸĞµÑ€ĞµĞ´ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸ĞµĞ¼ ĞµÑ‰Ğµ Ñ€Ğ°Ğ· Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ
Â  Â  Â  Â  db.bal = n(db.bal, 0);
Â  Â  Â  Â  localStorage.setItem('ton_final_elite', JSON.stringify(db));Â 
Â  Â  }

Â  Â  function update() {
Â  Â  Â  Â  let now = Date.now();
Â  Â  Â  Â  let dt = Math.max(0, (now - db.last) / 1000);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ĞĞ°Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ¿Ğ°ÑÑĞ¸Ğ²ĞºÑƒ
Â  Â  Â  Â  db.bal = n(db.bal + (n(db.pps) * dt));
Â  Â  Â  Â Â 
Â  Â  Â  Â  let maxN = db.vip ? 10000 : 250;
Â  Â  Â  Â  let reg = db.vip ? 1.0 : 0.25;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(db.nrg < maxN) {
Â  Â  Â  Â  Â  Â  db.nrg = Math.min(maxN, db.nrg + (dt * reg));
Â  Â  Â  Â  Â  Â  let remain = (maxN - db.nrg) / reg;
Â  Â  Â  Â  Â  Â  let m = Math.floor(remain / 60);
Â  Â  Â  Â  Â  Â  let s = Math.floor(remain % 60);
Â  Â  Â  Â  Â  Â  document.getElementById('energy-timer').innerText = `Ğ¤ÑƒĞ»Ğ» ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ·: ${m}:${s < 10 ? '0'+s : s}`;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  document.getElementById('energy-timer').innerText = "Ğ—Ğ°Ñ€ÑĞ¶ĞµĞ½Ğ¾ Ğ½Ğ° 100%";
Â  Â  Â  Â  }

Â  Â  Â  Â  db.last = now;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Ğ–ĞµÑÑ‚ĞºĞ¸Ğ¹ Ñ„Ğ¸ĞºÑ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ° Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ°
Â  Â  Â  Â  document.getElementById('balance').innerText = n(db.bal).toFixed(2);
Â  Â  Â  Â  document.getElementById('pps').innerText = n(db.pps).toFixed(2);
Â  Â  Â  Â  document.getElementById('energy').innerText = Math.floor(n(db.nrg));
Â  Â  Â  Â  document.getElementById('nrg-bar').style.width = (n(db.nrg)/maxN*100)+'%';
Â  Â  Â  Â Â 
Â  Â  Â  Â  renderQuests();
Â  Â  Â  Â  save();
Â  Â  }

Â  Â  // --- Ğ˜Ğ“Ğ Ğ« Ğ¡ Ğ—ĞĞ©Ğ˜Ğ¢ĞĞ™ ĞĞ¢ NaN ---

Â  Â  function startM() {
Â  Â  Â  Â  let input = document.getElementById('mb').value;
Â  Â  Â  Â  let b = n(input, 0); // Ğ•ÑĞ»Ğ¸ Ğ²Ğ²ĞµĞ»Ğ¸ Ğ´Ğ¸Ñ‡ÑŒ, Ğ±ÑƒĞ´ĞµÑ‚ 0
Â  Â  Â  Â  let c = parseInt(document.getElementById('mc').value);

Â  Â  Â  Â  if (b <= 0) return alert("Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½ÑƒÑ ÑÑ‚Ğ°Ğ²ĞºÑƒ!");
Â  Â  Â  Â  if (b > db.bal) return alert("ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ°!");
Â  Â  Â  Â  if (b > 10000000) return alert("ĞœĞ°ĞºÑ. ÑÑ‚Ğ°Ğ²ĞºĞ° 10,000,000!");

Â  Â  Â  Â  db.bal -= b;
Â  Â  Â  Â  cur = { active: true, bet: b, mult: 1, type: 'mines', data: Array(25).fill(false) };
Â  Â  Â  Â  let p=0; while(p<c){let r=Math.floor(Math.random()*25); if(!cur.data[r]){cur.data[r]=true; p++;}}
Â  Â  Â  Â Â 
Â  Â  Â  Â  let grid = document.getElementById('m-grid'); grid.innerHTML = '';
Â  Â  Â  Â  for(let i=0; i<25; i++) {
Â  Â  Â  Â  Â  Â  let d = document.createElement('div'); d.className = 'm-cell'; d.innerText = '?';
Â  Â  Â  Â  Â  Â  d.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  if(!cur.active || d.innerText !== '?') return;
Â  Â  Â  Â  Â  Â  Â  Â  if(cur.data[i]) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  d.innerText = 'ğŸ’£'; d.classList.add('open-bomb'); cur.active = false;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('btn-cashout').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('g-info').innerText = "Ğ’Ğ—Ğ Ğ«Ğ’! ĞŸĞ¾Ñ‚ĞµÑ€ÑĞ½Ğ¾: " + cur.bet.toFixed(2);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  else {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  d.innerText = 'ğŸ’'; d.classList.add('open-gem');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cur.mult += (c/4)+0.3;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('g-info').innerText = `ĞšÑƒÑˆ: ${(cur.bet*cur.mult).toFixed(2)} TON`;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('btn-cashout').style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }; grid.appendChild(d);
Â  Â  Â  Â  }
Â  Â  Â  Â  update();
Â  Â  }

Â  Â  function startL() {
Â  Â  Â  Â  let input = document.getElementById('lb').value;
Â  Â  Â  Â  let b = n(input, 0);

Â  Â  Â  Â  if (b <= 0) return alert("Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ÑÑ‚Ğ°Ğ²ĞºÑƒ!");
Â  Â  Â  Â  if (b > db.bal) return alert("ĞœĞ°Ğ»Ğ¾ TON!");
Â  Â  Â  Â  if (b > 10000000) return alert("ĞœĞ°ĞºÑ. ÑÑ‚Ğ°Ğ²ĞºĞ° 10,000,000!");

Â  Â  Â  Â  db.bal -= b;
Â  Â  Â  Â  cur = { active: true, bet: b, mult: 1, type: 'ladder', step: 0 };
Â  Â  Â  Â  let grid = document.getElementById('l-grid'); grid.innerHTML = '';
Â  Â  Â  Â  for(let i=0; i<6; i++) {
Â  Â  Â  Â  Â  Â  let r = document.createElement('div'); r.className = 'ladder-row' + (i>0?' locked':'');
Â  Â  Â  Â  Â  Â  let t = Math.floor(Math.random()*2);
Â  Â  Â  Â  Â  Â  r.innerHTML = `<div class="l-cell" onclick="stepL(0,${t},${i},this)">?</div><div class="l-cell" onclick="stepL(1,${t},${i},this)">?</div>`;
Â  Â  Â  Â  Â  Â  grid.appendChild(r);
Â  Â  Â  Â  }
Â  Â  Â  Â  update();
Â  Â  }

Â  Â  function stepL(ch, tr, idx, el) {
Â  Â  Â  Â  if(!cur.active || idx !== cur.step) return;
Â  Â  Â  Â  if(ch === tr) {Â 
Â  Â  Â  Â  Â  Â  el.innerText = 'ğŸ’¥'; el.style.background = '#ef4444'; cur.active = false;Â 
Â  Â  Â  Â  Â  Â  document.getElementById('btn-cashout').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('g-info').innerText = "Ğ£ĞŸĞĞ›!";
Â  Â  Â  Â  }
Â  Â  Â  Â  else {Â 
Â  Â  Â  Â  Â  Â  el.innerText = 'ğŸ’'; el.style.background = '#10b981';Â 
Â  Â  Â  Â  Â  Â  cur.mult *= 2.1; cur.step++;Â 
Â  Â  Â  Â  Â  Â  document.getElementById('g-info').innerText = `Ğ’Ñ‹Ğ¿Ğ»Ğ°Ñ‚Ğ°: ${(cur.bet * cur.mult).toFixed(2)}`;
Â  Â  Â  Â  Â  Â  document.getElementById('btn-cashout').style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  if(cur.step < 6) document.querySelectorAll('.ladder-row')[cur.step].classList.remove('locked');Â 
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function betWheel() {
Â  Â  Â  Â  let input = document.getElementById('wb').value;
Â  Â  Â  Â  let b = n(input, 0);
Â  Â  Â  Â  if(b < 1 || b > 1000000) return alert("Ğ¡Ñ‚Ğ°Ğ²ĞºĞ° Ğ¾Ñ‚ 1 Ğ´Ğ¾ 1,000,000!");
Â  Â  Â  Â  if(b > db.bal) return alert("ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ TON!");
Â  Â  Â  Â Â 
Â  Â  Â  Â  db.bal -= b;Â 
Â  Â  Â  Â  pot = n(pot + b);
Â  Â  Â  Â  document.getElementById('w-pot').innerText = `ĞĞ±Ñ‰Ğ¸Ğ¹ Ğ±Ğ°Ğ½Ğº: ${pot.toFixed(2)} TON`;
Â  Â  Â  Â  document.getElementById('w-players').innerText = "Ğ’Ñ‹ Ğ² Ğ¸Ğ³Ñ€Ğµ! ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°...";
Â  Â  Â  Â  update();
Â  Â  }

Â  Â  function doCashout() {Â 
Â  Â  Â  Â  if(!cur.active) return;Â 
Â  Â  Â  Â  let win = n(cur.bet * cur.mult);
Â  Â  Â  Â  db.bal = n(db.bal + win);Â 
Â  Â  Â  Â  cur.active = false;Â 
Â  Â  Â  Â  alert("ĞŸĞ¾Ğ±ĞµĞ´Ğ°! Ğ—Ğ°Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¾: " + win.toFixed(2) + " TON");
Â  Â  Â  Â  closeG();Â 
Â  Â  Â  Â  update();Â 
Â  Â  }

Â  Â  // --- ĞĞ¡Ğ¢ĞĞ›Ğ¬ĞĞ«Ğ• Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜ ---
Â  Â  function buyM(id, cost, p) {Â 
Â  Â  Â  Â  if(db.bal >= cost){Â 
Â  Â  Â  Â  Â  Â  db.bal -= cost;Â 
Â  Â  Â  Â  Â  Â  db.pps = n(db.pps + p);Â 
Â  Â  Â  Â  Â  Â  update();Â 
Â  Â  Â  Â  Â  Â  alert("Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ ĞºÑƒĞ¿Ğ»ĞµĞ½Ğ¾!");Â 
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  alert("ĞĞµ Ñ…Ğ²Ğ°Ñ‚Ğ°ĞµÑ‚ TON!");
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function claimDaily() {Â 
Â  Â  Â  Â  if(Date.now() - db.daily > 86400000){Â 
Â  Â  Â  Â  Â  Â  db.bal += 15;Â 
Â  Â  Â  Â  Â  Â  db.daily = Date.now();Â 
Â  Â  Â  Â  Â  Â  alert("Ğ‘Ğ¾Ğ½ÑƒÑ 15 TON Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½!");Â 
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  alert("Ğ‘Ğ¾Ğ½ÑƒÑ Ğ±ÑƒĞ´ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ñ‡ĞµÑ€ĞµĞ· 24 Ñ‡Ğ°ÑĞ°!");
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ†Ğ¸ĞºĞ»Ğ°
Â  Â  setInterval(update, 1000);
Â  Â  update();
</script>
