<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Magic Clicker V2</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background-color: #1a1a1a; color: white;
            text-align: center; font-family: 'Arial', sans-serif;
            margin: 0; overflow: hidden; display: flex;
            flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; position: relative;
        }
        .header { position: absolute; top: 20px; width: 100%; text-align: center; }
        .level { font-size: 18px; color: #3498db; font-weight: bold; margin-bottom: 5px; }
        .score { font-size: 36px; font-weight: bold; color: #f1c40f; }
        
        #coin {
            width: 200px; height: 200px;
            background: radial-gradient(circle, #f1c40f, #e67e22);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 80px; cursor: pointer; margin-top: 30px;
            box-shadow: 0 0 40px rgba(243, 156, 18, 0.6);
            transition: transform 0.05s; user-select: none;
            -webkit-tap-highlight-color: transparent; margin-bottom: 30px;
        }
        #coin:active { transform: scale(0.92); }
        
        .footer { position: absolute; bottom: 30px; width: 100%; display: flex; flex-direction: column; align-items: center; }
        .energy { font-size: 22px; color: #2ecc71; margin-bottom: 15px; font-weight: bold; }
        
        .shop-btn {
            background: #9b59b6; color: white; border: none;
            padding: 12px 30px; font-size: 18px; border-radius: 20px;
            cursor: pointer; font-weight: bold; box-shadow: 0 4px 10px rgba(155, 89, 182, 0.4);
        }
        
        /* –û–∫–Ω–æ –ú–∞–≥–∞–∑–∏–Ω–∞ */
        #shop {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95); flex-direction: column;
            align-items: center; justify-content: center; z-index: 100;
        }
        .shop-title { font-size: 28px; color: #f1c40f; margin-bottom: 20px; font-weight: bold; }
        .buy-btn {
            background: #34495e; color: white; border: 2px solid #f1c40f;
            padding: 15px; width: 80%; font-size: 18px; border-radius: 10px;
            margin-bottom: 15px; cursor: pointer; font-weight: bold; transition: 0.2s;
        }
        .buy-btn:active { background: #f1c40f; color: black; }
        .close-shop { background: #e74c3c; border-color: #c0392b; margin-top: 20px; }
        #shop-msg { margin-top: 15px; font-size: 18px; color: #e74c3c; font-weight: bold; text-align: center; padding: 0 20px; min-height: 50px;}
    </style>
</head>
<body>
    <div class="header">
        <div class="level" id="level-text">–£—Ä–æ–≤–µ–Ω—å: 1 (0/15000)</div>
        <div class="score">üí∞ <span id="balance">0</span></div>
    </div>
    
    <div id="coin">‚ö°Ô∏è</div>
    
    <div class="footer">
        <div class="energy">–≠–Ω–µ—Ä–≥–∏—è: <span id="energy-text">1000/1000</span></div>
        <button class="shop-btn" onclick="openShop()">üõí –ú–∞–≥–∞–∑–∏–Ω —ç–Ω–µ—Ä–≥–∏–∏</button>
    </div>

    <div id="shop">
        <div class="shop-title">–¢–∞–π–Ω–∞—è –õ–∞–≤–∫–∞</div>
        <button class="buy-btn" onclick="buyEnergy(1000)">üîã –ö—É–ø–∏—Ç—å 1 000 ‚ö°Ô∏è</button>
        <button class="buy-btn" onclick="buyEnergy(10000)">üîã –ö—É–ø–∏—Ç—å 10 000 ‚ö°Ô∏è</button>
        <button class="buy-btn" onclick="buyEnergy(100000)">üîã –ö—É–ø–∏—Ç—å 100 000 ‚ö°Ô∏è</button>
        <div id="shop-msg"></div>
        <button class="buy-btn close-shop" onclick="closeShop()">‚ùå –ó–∞–∫—Ä—ã—Ç—å –ª–∞–≤–∫—É</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand(); 

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ë–î
        let balance = 0;
        let clicksTotal = 0;
        let currentEnergy = 1000;
        let lastSaveTime = Date.now();

        // –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        const balanceEl = document.getElementById('balance');
        const levelEl = document.getElementById('level-text');
        const energyEl = document.getElementById('energy-text');
        const coin = document.getElementById('coin');
        const shopDiv = document.getElementById('shop');
        const shopMsg = document.getElementById('shop-msg');

        // 1. –ó–ê–ì–†–£–ó–ö–ê –ë–ê–ó–´ –î–ê–ù–ù–´–•
        function loadData() {
            let saved = localStorage.getItem('magic_clicker_db');
            if (saved) {
                let data = JSON.parse(saved);
                balance = data.balance || 0;
                clicksTotal = data.clicksTotal || 0;
                currentEnergy = data.energy !== undefined ? data.energy : 1000;
                lastSaveTime = data.lastSaveTime || Date.now();
            }
        }

        // 2. –í–´–ß–ò–°–õ–ï–ù–ò–ï –£–†–û–í–ù–Ø –ò –õ–ò–ú–ò–¢–û–í
        function getLevel() {
            let lvl = Math.floor(clicksTotal / 15000) + 1;
            return lvl > 100 ? 100 : lvl;
        }

        function getMaxEnergy(lvl) {
            if (lvl < 10) return 1000; // –î–æ 10 –ª–≤–ª = 1000
            let tens = Math.floor(lvl / 10); // 10 –ª–≤–ª = 1, 20 –ª–≤–ª = 2
            return tens * 10000; // 10 –ª–≤–ª = 10000, 20 –ª–≤–ª = 20000
        }

        // 3. –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –≠–ù–ï–†–ì–ò–ò –ó–ê –í–†–ï–ú–Ø –û–¢–°–£–¢–°–¢–í–ò–Ø
        function regenOfflineEnergy() {
            let now = Date.now();
            let hoursPassed = (now - lastSaveTime) / (1000 * 60 * 60);
            let energyToAdd = hoursPassed * 1000; // +1000 –≤ —á–∞—Å
            
            let maxE = getMaxEnergy(getLevel());
            currentEnergy += energyToAdd;
            if (currentEnergy > maxE) currentEnergy = maxE;
            lastSaveTime = now;
        }

        // 4. –°–û–•–†–ê–ù–ï–ù–ò–ï –í –ë–ê–ó–£ –î–ê–ù–ù–´–•
        function saveData() {
            let data = {
                balance: balance,
                clicksTotal: clicksTotal,
                energy: currentEnergy,
                lastSaveTime: Date.now()
            };
            localStorage.setItem('magic_clicker_db', JSON.stringify(data));
        }

        // 5. –û–ë–ù–û–í–õ–ï–ù–ò–ï –≠–ö–†–ê–ù–ê
        function updateUI() {
            balanceEl.innerText = balance.toLocaleString(); // –¶–∏—Ñ—Ä—ã —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ (1 000 000)
            
            let lvl = getLevel();
            let maxE = getMaxEnergy(lvl);
            let nextLvlClicks = lvl * 15000;
            
            if (lvl === 100) {
                levelEl.innerText = `–£—Ä–æ–≤–µ–Ω—å: 100 (MAX)`;
                levelEl.style.color = '#e74c3c'; // –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –Ω–∞ –º–∞–∫—Å –ª–≤–ª
            } else {
                levelEl.innerText = `–£—Ä–æ–≤–µ–Ω—å: ${lvl} (${clicksTotal}/${nextLvlClicks})`;
            }
            
            energyEl.innerText = `${Math.floor(currentEnergy)} / ${maxE}`;
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
        loadData();
        regenOfflineEnergy();
        updateUI();

        // 6. –ö–õ–ò–ö –ü–û –ú–û–ù–ï–¢–ï
        coin.addEventListener('click', () => {
            if (currentEnergy >= 1) {
                currentEnergy -= 1;
                clicksTotal += 1;
                
                let lvl = getLevel();
                // –ù–∞ 100 —É—Ä–æ–≤–Ω–µ –¥–∞–µ–º 1 000 000, –∏–Ω–∞—á–µ 1 –º–æ–Ω–µ—Ç—É
                let clickPower = (lvl >= 100) ? 1000000 : 1;
                balance += clickPower;
                
                if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
                
                updateUI();
            } else {
                // –ï—Å–ª–∏ –Ω–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏ - –º–∏–≥–∞–µ–º –∫—Ä–∞—Å–Ω—ã–º
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
                energyEl.style.color = '#e74c3c'; 
                setTimeout(() => energyEl.style.color = '#2ecc71', 300);
            }
        });

        // 7. –û–ù–õ–ê–ô–ù-–†–ï–ì–ï–ù–ï–†–ê–¶–ò–Ø –ò –ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï
        // +1000 –≤ —á–∞—Å = –ø—Ä–∏–º–µ—Ä–Ω–æ 0.27 —ç–Ω–µ—Ä–≥–∏–∏ –≤ —Å–µ–∫—É–Ω–¥—É
        setInterval(() => {
            let maxE = getMaxEnergy(getLevel());
            if (currentEnergy < maxE) {
                currentEnergy += (1000 / 3600); // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ª—é —Å–µ–∫—É–Ω–¥—ã
                if (currentEnergy > maxE) currentEnergy = maxE;
                updateUI();
            }
        }, 1000);
        
        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
        setInterval(saveData, 3000);

        // 8. –õ–û–ì–ò–ö–ê –ú–ê–ì–ê–ó–ò–ù–ê
        function openShop() {
            shopDiv.style.display = 'flex';
            shopMsg.innerText = '';
        }
        function closeShop() {
            shopDiv.style.display = 'none';
        }
        function buyEnergy(amount) {
            shopMsg.innerText = `–î–ª—è –ø–æ–∫—É–ø–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞–ø–∏—à–∏—Ç–µ @fresei`;
            if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('warning');
        }
    </script>
</body>
</html>
